!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.FerdiCore=e():t.FerdiCore=e()}(self,(()=>(()=>{var t={809:t=>{t.exports=()=>/(?:[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDD-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF6](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE74\uDE78-\uDE7C\uDE80-\uDE86\uDE90-\uDEAC\uDEB0-\uDEBA\uDEC0-\uDEC2\uDED0-\uDED9\uDEE0-\uDEE7]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?))/g},758:(t,e)=>{"use strict";e.V=void 0;var n=function(){function t(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return t.hashStr=function(t,e){return void 0===e&&(e=!1),this.onePassHasher.start().appendStr(t).end(e)},t.hashAsciiStr=function(t,e){return void 0===e&&(e=!1),this.onePassHasher.start().appendAsciiStr(t).end(e)},t._hex=function(e){var n,i,r,s,o=t.hexChars,u=t.hexOut;for(s=0;s<4;s+=1)for(i=8*s,n=e[s],r=0;r<8;r+=2)u[i+1+r]=o.charAt(15&n),n>>>=4,u[i+0+r]=o.charAt(15&n),n>>>=4;return u.join("")},t._md5cycle=function(t,e){var n=t[0],i=t[1],r=t[2],s=t[3];i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&r|~i&s)+e[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&r)+e[1]-389564586|0)<<12|s>>>20)+n|0)&n|~s&i)+e[2]+606105819|0)<<17|r>>>15)+s|0)&s|~r&n)+e[3]-1044525330|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&r|~i&s)+e[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&r)+e[5]+1200080426|0)<<12|s>>>20)+n|0)&n|~s&i)+e[6]-1473231341|0)<<17|r>>>15)+s|0)&s|~r&n)+e[7]-45705983|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&r|~i&s)+e[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&r)+e[9]-1958414417|0)<<12|s>>>20)+n|0)&n|~s&i)+e[10]-42063|0)<<17|r>>>15)+s|0)&s|~r&n)+e[11]-1990404162|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&r|~i&s)+e[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&r)+e[13]-40341101|0)<<12|s>>>20)+n|0)&n|~s&i)+e[14]-1502002290|0)<<17|r>>>15)+s|0)&s|~r&n)+e[15]+1236535329|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&s|r&~s)+e[1]-165796510|0)<<5|n>>>27)+i|0)&r|i&~r)+e[6]-1069501632|0)<<9|s>>>23)+n|0)&i|n&~i)+e[11]+643717713|0)<<14|r>>>18)+s|0)&n|s&~n)+e[0]-373897302|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&s|r&~s)+e[5]-701558691|0)<<5|n>>>27)+i|0)&r|i&~r)+e[10]+38016083|0)<<9|s>>>23)+n|0)&i|n&~i)+e[15]-660478335|0)<<14|r>>>18)+s|0)&n|s&~n)+e[4]-405537848|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&s|r&~s)+e[9]+568446438|0)<<5|n>>>27)+i|0)&r|i&~r)+e[14]-1019803690|0)<<9|s>>>23)+n|0)&i|n&~i)+e[3]-187363961|0)<<14|r>>>18)+s|0)&n|s&~n)+e[8]+1163531501|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i&s|r&~s)+e[13]-1444681467|0)<<5|n>>>27)+i|0)&r|i&~r)+e[2]-51403784|0)<<9|s>>>23)+n|0)&i|n&~i)+e[7]+1735328473|0)<<14|r>>>18)+s|0)&n|s&~n)+e[12]-1926607734|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i^r^s)+e[5]-378558|0)<<4|n>>>28)+i|0)^i^r)+e[8]-2022574463|0)<<11|s>>>21)+n|0)^n^i)+e[11]+1839030562|0)<<16|r>>>16)+s|0)^s^n)+e[14]-35309556|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i^r^s)+e[1]-1530992060|0)<<4|n>>>28)+i|0)^i^r)+e[4]+1272893353|0)<<11|s>>>21)+n|0)^n^i)+e[7]-155497632|0)<<16|r>>>16)+s|0)^s^n)+e[10]-1094730640|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i^r^s)+e[13]+681279174|0)<<4|n>>>28)+i|0)^i^r)+e[0]-358537222|0)<<11|s>>>21)+n|0)^n^i)+e[3]-722521979|0)<<16|r>>>16)+s|0)^s^n)+e[6]+76029189|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((s=((s+=((n=((n+=(i^r^s)+e[9]-640364487|0)<<4|n>>>28)+i|0)^i^r)+e[12]-421815835|0)<<11|s>>>21)+n|0)^n^i)+e[15]+530742520|0)<<16|r>>>16)+s|0)^s^n)+e[2]-995338651|0)<<23|i>>>9)+r|0,i=((i+=((s=((s+=(i^((n=((n+=(r^(i|~s))+e[0]-198630844|0)<<6|n>>>26)+i|0)|~r))+e[7]+1126891415|0)<<10|s>>>22)+n|0)^((r=((r+=(n^(s|~i))+e[14]-1416354905|0)<<15|r>>>17)+s|0)|~n))+e[5]-57434055|0)<<21|i>>>11)+r|0,i=((i+=((s=((s+=(i^((n=((n+=(r^(i|~s))+e[12]+1700485571|0)<<6|n>>>26)+i|0)|~r))+e[3]-1894986606|0)<<10|s>>>22)+n|0)^((r=((r+=(n^(s|~i))+e[10]-1051523|0)<<15|r>>>17)+s|0)|~n))+e[1]-2054922799|0)<<21|i>>>11)+r|0,i=((i+=((s=((s+=(i^((n=((n+=(r^(i|~s))+e[8]+1873313359|0)<<6|n>>>26)+i|0)|~r))+e[15]-30611744|0)<<10|s>>>22)+n|0)^((r=((r+=(n^(s|~i))+e[6]-1560198380|0)<<15|r>>>17)+s|0)|~n))+e[13]+1309151649|0)<<21|i>>>11)+r|0,i=((i+=((s=((s+=(i^((n=((n+=(r^(i|~s))+e[4]-145523070|0)<<6|n>>>26)+i|0)|~r))+e[11]-1120210379|0)<<10|s>>>22)+n|0)^((r=((r+=(n^(s|~i))+e[2]+718787259|0)<<15|r>>>17)+s|0)|~n))+e[9]-343485551|0)<<21|i>>>11)+r|0,t[0]=n+t[0]|0,t[1]=i+t[1]|0,t[2]=r+t[2]|0,t[3]=s+t[3]|0},t.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(t.stateIdentity),this},t.prototype.appendStr=function(e){var n,i,r=this._buffer8,s=this._buffer32,o=this._bufferLength;for(i=0;i<e.length;i+=1){if((n=e.charCodeAt(i))<128)r[o++]=n;else if(n<2048)r[o++]=192+(n>>>6),r[o++]=63&n|128;else if(n<55296||n>56319)r[o++]=224+(n>>>12),r[o++]=n>>>6&63|128,r[o++]=63&n|128;else{if((n=1024*(n-55296)+(e.charCodeAt(++i)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");r[o++]=240+(n>>>18),r[o++]=n>>>12&63|128,r[o++]=n>>>6&63|128,r[o++]=63&n|128}o>=64&&(this._dataLength+=64,t._md5cycle(this._state,s),o-=64,s[0]=s[16])}return this._bufferLength=o,this},t.prototype.appendAsciiStr=function(e){for(var n,i=this._buffer8,r=this._buffer32,s=this._bufferLength,o=0;;){for(n=Math.min(e.length-o,64-s);n--;)i[s++]=e.charCodeAt(o++);if(s<64)break;this._dataLength+=64,t._md5cycle(this._state,r),s=0}return this._bufferLength=s,this},t.prototype.appendByteArray=function(e){for(var n,i=this._buffer8,r=this._buffer32,s=this._bufferLength,o=0;;){for(n=Math.min(e.length-o,64-s);n--;)i[s++]=e[o++];if(s<64)break;this._dataLength+=64,t._md5cycle(this._state,r),s=0}return this._bufferLength=s,this},t.prototype.getState=function(){var t=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[t[0],t[1],t[2],t[3]]}},t.prototype.setState=function(t){var e,n=t.buffer,i=t.state,r=this._state;for(this._dataLength=t.length,this._bufferLength=t.buflen,r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],e=0;e<n.length;e+=1)this._buffer8[e]=n.charCodeAt(e)},t.prototype.end=function(e){void 0===e&&(e=!1);var n=this._bufferLength,i=this._buffer8,r=this._buffer32,s=1+(n>>2);this._dataLength+=n;var o=8*this._dataLength;if(i[n]=128,i[n+1]=i[n+2]=i[n+3]=0,r.set(t.buffer32Identity.subarray(s),s),n>55&&(t._md5cycle(this._state,r),r.set(t.buffer32Identity)),o<=4294967295)r[14]=o;else{var u=o.toString(16).match(/(.*?)(.{0,8})$/);if(null===u)return;var a=parseInt(u[2],16),l=parseInt(u[1],16)||0;r[14]=a,r[15]=l}return t._md5cycle(this._state,r),e?this._state:t._hex(this._state)},t.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),t.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t.hexChars="0123456789abcdef",t.hexOut=[],t.onePassHasher=new t,t}();if(e.V=n,"5d41402abc4b2a76b9719d911017c592"!==n.hashStr("hello"))throw new Error("Md5 self test failed.")}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i={};return(()=>{"use strict";n.d(i,{default:()=>Bi});const t=(t,e,n,i)=>function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))}(void 0,void 0,void 0,(function*(){const r={token:e,"content-type":"application/x-www-form-urlencoded"};let s=[];for(const t in n){const e=encodeURIComponent(t),i=encodeURIComponent(n[t]);s.push(e+"="+i)}const o=s.join("&");try{return yield i(t,{method:"POST",headers:r,body:n?o:null})}catch(t){throw console.error(t),t}}));var e=n(758);class r{constructor(){this.events={}}on(t,e){const n=this.events[t]||[];n.push(e),this.events[t]=n}emit(t,...e){(this.events[t]||[]).forEach((t=>t(...e)))}off(t,e){const n=(this.events[t]||[]).filter((t=>t!=e&&t.initialCallback!=e));this.events[t]=n}once(t,e){const n=(...i)=>{e(...i),this.off(t,n)};n.initialCallback=e,this.on(t,n)}}const s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,o=Object.keys,u=Array.isArray;function a(t,e){return"object"!=typeof e||o(e).forEach((function(n){t[n]=e[n]})),t}"undefined"==typeof Promise||s.Promise||(s.Promise=Promise);const l=Object.getPrototypeOf,c={}.hasOwnProperty;function h(t,e){return c.call(t,e)}function D(t,e){"function"==typeof e&&(e=e(l(t))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(e).forEach((n=>{p(t,n,e[n])}))}const d=Object.defineProperty;function p(t,e,n,i){d(t,e,a(n&&h(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},i))}function f(t){return{from:function(e){return t.prototype=Object.create(e.prototype),p(t.prototype,"constructor",t),{extend:D.bind(null,t.prototype)}}}}const g=Object.getOwnPropertyDescriptor;function m(t,e){let n;return g(t,e)||(n=l(t))&&m(n,e)}const y=[].slice;function v(t,e,n){return y.call(t,e,n)}function F(t,e){return e(t)}function b(t){if(!t)throw new Error("Assertion Failed")}function E(t){s.setImmediate?setImmediate(t):setTimeout(t,0)}function C(t,e){return t.reduce(((t,n,i)=>{var r=e(n,i);return r&&(t[r[0]]=r[1]),t}),{})}function w(t,e){if(h(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],i=0,r=e.length;i<r;++i){var s=w(t,e[i]);n.push(s)}return n}var o=e.indexOf(".");if(-1!==o){var u=t[e.substr(0,o)];return void 0===u?void 0:w(u,e.substr(o+1))}}function x(t,e,n){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){b("string"!=typeof n&&"length"in n);for(var i=0,r=e.length;i<r;++i)x(t,e[i],n[i])}else{var s=e.indexOf(".");if(-1!==s){var o=e.substr(0,s),a=e.substr(s+1);if(""===a)void 0===n?u(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var l=t[o];l&&h(t,o)||(l=t[o]={}),x(l,a,n)}}else void 0===n?u(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function B(t){var e={};for(var n in t)h(t,n)&&(e[n]=t[n]);return e}const _=[].concat;function S(t){return _.apply([],t)}const T="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(S([8,16,32,64].map((t=>["Int","Uint","Float"].map((e=>e+t+"Array")))))).filter((t=>s[t])),k=T.map((t=>s[t]));C(T,(t=>[t,!0]));let A=null;function I(t){A="undefined"!=typeof WeakMap&&new WeakMap;const e=O(t);return A=null,e}function O(t){if(!t||"object"!=typeof t)return t;let e=A&&A.get(t);if(e)return e;if(u(t)){e=[],A&&A.set(t,e);for(var n=0,i=t.length;n<i;++n)e.push(O(t[n]))}else if(k.indexOf(t.constructor)>=0)e=t;else{const n=l(t);for(var r in e=n===Object.prototype?{}:Object.create(n),A&&A.set(t,e),t)h(t,r)&&(e[r]=O(t[r]))}return e}const{toString:P}={};function R(t){return P.call(t).slice(8,-1)}const j="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",K="symbol"==typeof j?function(t){var e;return null!=t&&(e=t[j])&&e.apply(t)}:function(){return null},M={};function q(t){var e,n,i,r;if(1===arguments.length){if(u(t))return t.slice();if(this===M&&"string"==typeof t)return[t];if(r=K(t)){for(n=[];!(i=r.next()).done;)n.push(i.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const N="undefined"!=typeof Symbol?t=>"AsyncFunction"===t[Symbol.toStringTag]:()=>!1;var L="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function $(t,e){L=t,H=e}var H=()=>!0;const z=!new Error("").stack;function U(){if(z)try{throw U.arguments,new Error}catch(t){return t}return new Error}function V(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(H).map((t=>"\n"+t)).join("")):""}var W=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],G=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(W),Y={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function J(t,e){this._e=U(),this.name=t,this.message=e}function X(t,e){return t+". Errors: "+Object.keys(e).map((t=>e[t].toString())).filter(((t,e,n)=>n.indexOf(t)===e)).join("\n")}function Q(t,e,n,i){this._e=U(),this.failures=e,this.failedKeys=i,this.successCount=n,this.message=X(t,e)}function Z(t,e){this._e=U(),this.name="BulkError",this.failures=Object.keys(e).map((t=>e[t])),this.failuresByPos=e,this.message=X(t,e)}f(J).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+V(this._e,2))}},toString:function(){return this.name+": "+this.message}}),f(Q).from(J),f(Z).from(J);var tt=G.reduce(((t,e)=>(t[e]=e+"Error",t)),{});const et=J;var nt=G.reduce(((t,e)=>{var n=e+"Error";function i(t,i){this._e=U(),this.name=n,t?"string"==typeof t?(this.message=`${t}${i?"\n "+i:""}`,this.inner=i||null):"object"==typeof t&&(this.message=`${t.name} ${t.message}`,this.inner=t):(this.message=Y[e]||n,this.inner=null)}return f(i).from(et),t[e]=i,t}),{});nt.Syntax=SyntaxError,nt.Type=TypeError,nt.Range=RangeError;var it=W.reduce(((t,e)=>(t[e+"Error"]=nt[e],t)),{}),rt=G.reduce(((t,e)=>(-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=nt[e]),t)),{});function st(){}function ot(t){return t}function ut(t,e){return null==t||t===ot?e:function(n){return e(t(n))}}function at(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function lt(t,e){return t===st?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var i=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?at(i,this.onsuccess):i),r&&(this.onerror=this.onerror?at(r,this.onerror):r),void 0!==s?s:n}}function ct(t,e){return t===st?e:function(){t.apply(this,arguments);var n=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?at(n,this.onsuccess):n),i&&(this.onerror=this.onerror?at(i,this.onerror):i)}}function ht(t,e){return t===st?e:function(n){var i=t.apply(this,arguments);a(n,i);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?at(r,this.onsuccess):r),s&&(this.onerror=this.onerror?at(s,this.onerror):s),void 0===i?void 0===o?void 0:o:a(i,o)}}function Dt(t,e){return t===st?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function dt(t,e){return t===st?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var i=this,r=arguments.length,s=new Array(r);r--;)s[r]=arguments[r];return n.then((function(){return e.apply(i,s)}))}return e.apply(this,arguments)}}rt.ModifyError=Q,rt.DexieError=J,rt.BulkError=Z;var pt={};const[ft,gt,mt]="undefined"==typeof Promise?[]:(()=>{let t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,l(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,l(e),t]})(),yt=gt&&gt.then,vt=ft&&ft.constructor,Ft=!!mt;var bt=!1,Et=mt?()=>{mt.then(Ut)}:s.setImmediate?setImmediate.bind(null,Ut):s.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver((()=>{Ut(),t=null})).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Ut,0)},Ct=function(t,e){It.push([t,e]),xt&&(Et(),xt=!1)},wt=!0,xt=!0,Bt=[],_t=[],St=null,Tt=ot,kt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:fe,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((t=>{try{fe(t[0],t[1])}catch(t){}}))}},At=kt,It=[],Ot=0,Pt=[];function Rt(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=st,this._lib=!1;var e=this._PSD=At;if(L&&(this._stackHolder=U(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==pt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&qt(this,this._value))}this._state=null,this._value=null,++e.ref,Mt(this,t)}const jt={get:function(){var t=At,e=ee;function n(n,i){var r=!t.global&&(t!==At||e!==ee);const s=r&&!se();var o=new Rt(((e,o)=>{Lt(this,new Kt(de(n,t,r,s),de(i,t,r,s),e,o,t))}));return L&&zt(o,this),o}return n.prototype=pt,n},set:function(t){p(this,"then",t&&t.prototype===pt?jt:{get:function(){return t},set:jt.set})}};function Kt(t,e,n,i,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=i,this.psd=r}function Mt(t,e){try{e((e=>{if(null===t._state){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&Vt();e&&"function"==typeof e.then?Mt(t,((t,n)=>{e instanceof Rt?e._then(t,n):e.then(t,n)})):(t._state=!0,t._value=e,Nt(t)),n&&Wt()}}),qt.bind(null,t))}catch(e){qt(t,e)}}function qt(t,e){if(_t.push(e),null===t._state){var n=t._lib&&Vt();e=Tt(e),t._state=!1,t._value=e,L&&null!==e&&"object"==typeof e&&!e._promise&&function(t,e,n){try{t.apply(null,void 0)}catch(t){}}((()=>{var n=m(e,"stack");e._promise=t,p(e,"stack",{get:()=>bt?n&&(n.get?n.get.apply(e):n.value):t.stack})})),function(t){Bt.some((e=>e._value===t._value))||Bt.push(t)}(t),Nt(t),n&&Wt()}}function Nt(t){var e=t._listeners;t._listeners=[];for(var n=0,i=e.length;n<i;++n)Lt(t,e[n]);var r=t._PSD;--r.ref||r.finalize(),0===Ot&&(++Ot,Ct((()=>{0==--Ot&&Gt()}),[]))}function Lt(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ot,Ct($t,[n,t,e])}else t._listeners.push(e)}function $t(t,e,n){try{St=e;var i,r=e._value;e._state?i=t(r):(_t.length&&(_t=[]),i=t(r),-1===_t.indexOf(r)&&function(t){for(var e=Bt.length;e;)if(Bt[--e]._value===t._value)return void Bt.splice(e,1)}(e)),n.resolve(i)}catch(t){n.reject(t)}finally{St=null,0==--Ot&&Gt(),--n.psd.ref||n.psd.finalize()}}function Ht(t,e,n){if(e.length===n)return e;var i="";if(!1===t._state){var r,s,o=t._value;null!=o?(r=o.name||"Error",s=o.message||o,i=V(o,0)):(r=o,s=""),e.push(r+(s?": "+s:"")+i)}return L&&((i=V(t._stackHolder,2))&&-1===e.indexOf(i)&&e.push(i),t._prev&&Ht(t._prev,e,n)),e}function zt(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function Ut(){Vt()&&Wt()}function Vt(){var t=wt;return wt=!1,xt=!1,t}function Wt(){var t,e,n;do{for(;It.length>0;)for(t=It,It=[],n=t.length,e=0;e<n;++e){var i=t[e];i[0].apply(null,i[1])}}while(It.length>0);wt=!0,xt=!0}function Gt(){var t=Bt;Bt=[],t.forEach((t=>{t._PSD.onunhandled.call(null,t._value,t)}));for(var e=Pt.slice(0),n=e.length;n;)e[--n]()}function Yt(t){return new Rt(pt,!1,t)}function Jt(t,e){var n=At;return function(){var i=Vt(),r=At;try{return le(n,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{le(r,!1),i&&Wt()}}}D(Rt.prototype,{then:jt,_then:function(t,e){Lt(this,new Kt(null,null,t,e,At))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return"function"==typeof e?this.then(null,(t=>t instanceof e?n(t):Yt(t))):this.then(null,(t=>t&&t.name===e?n(t):Yt(t)))},finally:function(t){return this.then((e=>(t(),e)),(e=>(t(),Yt(e))))},stack:{get:function(){if(this._stack)return this._stack;try{bt=!0;var t=Ht(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{bt=!1}}},timeout:function(t,e){return t<1/0?new Rt(((n,i)=>{var r=setTimeout((()=>i(new nt.Timeout(e))),t);this.then(n,i).finally(clearTimeout.bind(null,r))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&p(Rt.prototype,Symbol.toStringTag,"Dexie.Promise"),kt.env=ce(),D(Rt,{all:function(){var t=q.apply(null,arguments).map(oe);return new Rt((function(e,n){0===t.length&&e([]);var i=t.length;t.forEach(((r,s)=>Rt.resolve(r).then((n=>{t[s]=n,--i||e(t)}),n)))}))},resolve:t=>{if(t instanceof Rt)return t;if(t&&"function"==typeof t.then)return new Rt(((e,n)=>{t.then(e,n)}));var e=new Rt(pt,!0,t);return zt(e,St),e},reject:Yt,race:function(){var t=q.apply(null,arguments).map(oe);return new Rt(((e,n)=>{t.map((t=>Rt.resolve(t).then(e,n)))}))},PSD:{get:()=>At,set:t=>At=t},totalEchoes:{get:()=>ee},newPSD:ie,usePSD:he,scheduler:{get:()=>Ct,set:t=>{Ct=t}},rejectionMapper:{get:()=>Tt,set:t=>{Tt=t}},follow:(t,e)=>new Rt(((n,i)=>ie(((e,n)=>{var i=At;i.unhandleds=[],i.onunhandled=n,i.finalize=at((function(){!function(t){Pt.push((function e(){t(),Pt.splice(Pt.indexOf(e),1)})),++Ot,Ct((()=>{0==--Ot&&Gt()}),[])}((()=>{0===this.unhandleds.length?e():n(this.unhandleds[0])}))}),i.finalize),t()}),e,n,i)))}),vt&&(vt.allSettled&&p(Rt,"allSettled",(function(){const t=q.apply(null,arguments).map(oe);return new Rt((e=>{0===t.length&&e([]);let n=t.length;const i=new Array(n);t.forEach(((t,r)=>Rt.resolve(t).then((t=>i[r]={status:"fulfilled",value:t}),(t=>i[r]={status:"rejected",reason:t})).then((()=>--n||e(i)))))}))})),vt.any&&"undefined"!=typeof AggregateError&&p(Rt,"any",(function(){const t=q.apply(null,arguments).map(oe);return new Rt(((e,n)=>{0===t.length&&n(new AggregateError([]));let i=t.length;const r=new Array(i);t.forEach(((t,s)=>Rt.resolve(t).then((t=>e(t)),(t=>{r[s]=t,--i||n(new AggregateError(r))}))))}))})));const Xt={awaits:0,echoes:0,id:0};var Qt=0,Zt=[],te=0,ee=0,ne=0;function ie(t,e,n,i){var r=At,s=Object.create(r);s.parent=r,s.ref=0,s.global=!1,s.id=++ne;var o=kt.env;s.env=Ft?{Promise:Rt,PromiseProp:{value:Rt,configurable:!0,writable:!0},all:Rt.all,race:Rt.race,allSettled:Rt.allSettled,any:Rt.any,resolve:Rt.resolve,reject:Rt.reject,nthen:pe(o.nthen,s),gthen:pe(o.gthen,s)}:{},e&&a(s,e),++r.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=he(s,t,n,i);return 0===s.ref&&s.finalize(),u}function re(){return Xt.id||(Xt.id=++Qt),++Xt.awaits,Xt.echoes+=100,Xt.id}function se(){return!!Xt.awaits&&(0==--Xt.awaits&&(Xt.id=0),Xt.echoes=100*Xt.awaits,!0)}function oe(t){return Xt.echoes&&t&&t.constructor===vt?(re(),t.then((t=>(se(),t)),(t=>(se(),ge(t))))):t}function ue(t){++ee,Xt.echoes&&0!=--Xt.echoes||(Xt.echoes=Xt.id=0),Zt.push(At),le(t,!0)}function ae(){var t=Zt[Zt.length-1];Zt.pop(),le(t,!1)}function le(t,e){var n=At;if((e?!Xt.echoes||te++&&t===At:!te||--te&&t===At)||De(e?ue.bind(null,t):ae),t!==At&&(At=t,n===kt&&(kt.env=ce()),Ft)){var i=kt.env.Promise,r=t.env;gt.then=r.nthen,i.prototype.then=r.gthen,(n.global||t.global)&&(Object.defineProperty(s,"Promise",r.PromiseProp),i.all=r.all,i.race=r.race,i.resolve=r.resolve,i.reject=r.reject,r.allSettled&&(i.allSettled=r.allSettled),r.any&&(i.any=r.any))}}function ce(){var t=s.Promise;return Ft?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:gt.then,gthen:t.prototype.then}:{}}function he(t,e,n,i,r){var s=At;try{return le(t,!0),e(n,i,r)}finally{le(s,!1)}}function De(t){yt.call(ft,t)}function de(t,e,n,i){return"function"!=typeof t?t:function(){var r=At;n&&re(),le(e,!0);try{return t.apply(this,arguments)}finally{le(r,!1),i&&De(se)}}}function pe(t,e){return function(n,i){return t.call(this,de(n,e),de(i,e))}}function fe(t,e){var n;try{n=e.onuncatched(t)}catch(t){}if(!1!==n)try{var i,r={promise:e,reason:t};if(s.document&&document.createEvent?((i=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),a(i,r)):s.CustomEvent&&a(i=new CustomEvent("unhandledrejection",{detail:r}),r),i&&s.dispatchEvent&&(dispatchEvent(i),!s.PromiseRejectionEvent&&s.onunhandledrejection))try{s.onunhandledrejection(i)}catch(t){}L&&i&&!i.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(t){}}-1===(""+yt).indexOf("[native code]")&&(re=se=st);var ge=Rt.reject;function me(t,e,n,i){if(t.idbdb&&(t._state.openComplete||At.letThrough||t._vip)){var r=t._createTransaction(e,n,t._dbSchema);try{r.create(),t._state.PR1398_maxLoop=3}catch(r){return r.name===tt.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then((()=>me(t,e,n,i)))):ge(r)}return r._promise(e,((t,e)=>ie((()=>(At.trans=r,i(t,e,r)))))).then((t=>r._completion.then((()=>t))))}if(t._state.openComplete)return ge(new nt.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return ge(new nt.DatabaseClosed);t.open().catch(st)}return t._state.dbReadyPromise.then((()=>me(t,e,n,i)))}const ye=String.fromCharCode(65535),ve="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Fe=[],be="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ee=be,Ce=be,we=t=>!/(dexie\.js|dexie\.min\.js)/.test(t);function xe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Be={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function _e(t){return"string"!=typeof t||/\./.test(t)?t=>t:e=>(void 0===e[t]&&t in e&&delete(e=I(e))[t],e)}class Se{_trans(t,e,n){const i=this._tx||At.trans,r=this.name;function s(t,n,i){if(!i.schema[r])throw new nt.NotFound("Table "+r+" not part of transaction");return e(i.idbtrans,i)}const o=Vt();try{return i&&i.db===this.db?i===At.trans?i._promise(t,s,n):ie((()=>i._promise(t,s,n)),{trans:i,transless:At.transless||At}):me(this.db,t,[this.name],s)}finally{o&&Wt()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",(e=>this.core.get({trans:e,key:t}).then((t=>this.hook.reading.fire(t))))).then(e)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(u(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const e=o(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((t=>t.compound&&e.every((e=>t.keyPath.indexOf(e)>=0))&&t.keyPath.every((t=>e.indexOf(t)>=0))))[0];if(n&&this.db._maxKey!==ye)return this.where(n.name).equals(n.keyPath.map((e=>t[e])));!n&&L&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);const{idxByName:i}=this.schema,r=this.db._deps.indexedDB;function s(t,e){try{return 0===r.cmp(t,e)}catch(t){return!1}}const[a,l]=e.reduce((([e,n],r)=>{const o=i[r],a=t[r];return[e||o,e||!o?xe(n,o&&o.multi?t=>{const e=w(t,r);return u(e)&&e.some((t=>s(a,t)))}:t=>s(a,w(t,r))):n]}),[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(l):n?this.filter(l):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,u(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const e=e=>{if(!e)return e;const n=Object.create(t.prototype);for(var i in e)if(h(e,i))try{n[i]=e[i]}catch(t){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass((function(t){a(this,t)}))}add(t,e){const{auto:n,keyPath:i}=this.schema.primKey;let r=t;return i&&n&&(r=_e(i)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[r]}))).then((t=>t.numFailures?Rt.reject(t.failures[0]):t.lastResult)).then((e=>{if(i)try{x(t,i,e)}catch(t){}return e}))}update(t,e){if("object"!=typeof t||u(t))return this.where(":id").equals(t).modify(e);{const n=w(t,this.schema.primKey.keyPath);if(void 0===n)return ge(new nt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof e?o(e).forEach((n=>{x(t,n,e[n])})):e(t,{value:t,primKey:n})}catch(t){}return this.where(":id").equals(n).modify(e)}}put(t,e){const{auto:n,keyPath:i}=this.schema.primKey;let r=t;return i&&n&&(r=_e(i)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"put",values:[r],keys:null!=e?[e]:null}))).then((t=>t.numFailures?Rt.reject(t.failures[0]):t.lastResult)).then((e=>{if(i)try{x(t,i,e)}catch(t){}return e}))}delete(t){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:[t]}))).then((t=>t.numFailures?Rt.reject(t.failures[0]):void 0))}clear(){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"deleteRange",range:Be}))).then((t=>t.numFailures?Rt.reject(t.failures[0]):void 0))}bulkGet(t){return this._trans("readonly",(e=>this.core.getMany({keys:t,trans:e}).then((t=>t.map((t=>this.hook.reading.fire(t)))))))}bulkAdd(t,e,n){const i=Array.isArray(e)?e:void 0,r=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&i)throw new nt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new nt.InvalidArgument("Arguments objects and keys must have the same length");const o=t.length;let u=s&&n?t.map(_e(s)):t;return this.core.mutate({trans:e,type:"add",keys:i,values:u,wantResults:r}).then((({numFailures:t,results:e,lastResult:n,failures:i})=>{if(0===t)return r?e:n;throw new Z(`${this.name}.bulkAdd(): ${t} of ${o} operations failed`,i)}))}))}bulkPut(t,e,n){const i=Array.isArray(e)?e:void 0,r=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:n,keyPath:s}=this.schema.primKey;if(s&&i)throw new nt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new nt.InvalidArgument("Arguments objects and keys must have the same length");const o=t.length;let u=s&&n?t.map(_e(s)):t;return this.core.mutate({trans:e,type:"put",keys:i,values:u,wantResults:r}).then((({numFailures:t,results:e,lastResult:n,failures:i})=>{if(0===t)return r?e:n;throw new Z(`${this.name}.bulkPut(): ${t} of ${o} operations failed`,i)}))}))}bulkDelete(t){const e=t.length;return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:t}))).then((({numFailures:t,lastResult:n,failures:i})=>{if(0===t)return n;throw new Z(`${this.name}.bulkDelete(): ${t} of ${e} operations failed`,i)}))}}function Te(t){var e={},n=function(n,i){if(i){for(var r=arguments.length,s=new Array(r-1);--r;)s[r-1]=arguments[r];return e[n].subscribe.apply(null,s),t}if("string"==typeof n)return e[n]};n.addEventType=s;for(var i=1,r=arguments.length;i<r;++i)s(arguments[i]);return n;function s(t,i,r){if("object"==typeof t)return a(t);i||(i=Dt),r||(r=st);var s={subscribers:[],fire:r,subscribe:function(t){-1===s.subscribers.indexOf(t)&&(s.subscribers.push(t),s.fire=i(s.fire,t))},unsubscribe:function(t){s.subscribers=s.subscribers.filter((function(e){return e!==t})),s.fire=s.subscribers.reduce(i,r)}};return e[t]=n[t]=s,s}function a(t){o(t).forEach((function(e){var n=t[e];if(u(n))s(e,t[e][0],t[e][1]);else{if("asap"!==n)throw new nt.InvalidArgument("Invalid event config");var i=s(e,ot,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];i.subscribers.forEach((function(t){E((function(){t.apply(null,e)}))}))}))}}))}}function ke(t,e){return f(e).from({prototype:t}),e}function Ae(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Ie(t,e){t.filter=xe(t.filter,e)}function Oe(t,e,n){var i=t.replayFilter;t.replayFilter=i?()=>xe(i(),e()):e,t.justLimit=n&&!i}function Pe(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new nt.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Re(t,e,n){const i=Pe(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:i,range:t.range}})}function je(t,e,n,i){const r=t.replayFilter?xe(t.filter,t.replayFilter()):t.filter;if(t.or){const s={},o=(t,n,i)=>{if(!r||r(n,i,(t=>n.stop(t)),(t=>n.fail(t)))){var o=n.primaryKey,u=""+o;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(o)),h(s,u)||(s[u]=!0,e(t,n,i))}};return Promise.all([t.or._iterate(o,n),Ke(Re(t,i,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return Ke(Re(t,i,n),xe(t.algorithm,r),e,!t.keysOnly&&t.valueMapper)}function Ke(t,e,n,i){var r=Jt(i?(t,e,r)=>n(i(t),e,r):n);return t.then((t=>{if(t)return t.start((()=>{var n=()=>t.continue();e&&!e(t,(t=>n=t),(e=>{t.stop(e),n=st}),(e=>{t.fail(e),n=st}))||r(t.value,t,(t=>n=t)),n()}))}))}function Me(t,e){try{const n=qe(t),i=qe(e);if(n!==i)return"Array"===n?1:"Array"===i?-1:"binary"===n?1:"binary"===i?-1:"string"===n?1:"string"===i?-1:"Date"===n?1:"Date"!==i?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(t,e){const n=t.length,i=e.length,r=n<i?n:i;for(let n=0;n<r;++n)if(t[n]!==e[n])return t[n]<e[n]?-1:1;return n===i?0:n<i?-1:1}(Ne(t),Ne(e));case"Array":return function(t,e){const n=t.length,i=e.length,r=n<i?n:i;for(let n=0;n<r;++n){const i=Me(t[n],e[n]);if(0!==i)return i}return n===i?0:n<i?-1:1}(t,e)}}catch(t){}return NaN}function qe(t){const e=typeof t;if("object"!==e)return e;if(ArrayBuffer.isView(t))return"binary";const n=R(t);return"ArrayBuffer"===n?"binary":n}function Ne(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class Le{_read(t,e){var n=this._ctx;return n.error?n.table._trans(null,ge.bind(null,n.error)):n.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,ge.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=xe(e.algorithm,t)}_iterate(t,e){return je(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&a(n,t),e._ctx=n,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read((n=>je(e,t,n,e.table.core)))}count(t){return this._read((t=>{const e=this._ctx,n=e.table.core;if(Ae(e,!0))return n.count({trans:t,query:{index:Pe(e,n.schema),range:e.range}}).then((t=>Math.min(t,e.limit)));var i=0;return je(e,(()=>(++i,!1)),t,n).then((()=>i))})).then(t)}sortBy(t,e){const n=t.split(".").reverse(),i=n[0],r=n.length-1;function s(t,e){return e?s(t[n[e]],e-1):t[i]}var o="next"===this._ctx.dir?1:-1;function u(t,e){var n=s(t,r),i=s(e,r);return n<i?-o:n>i?o:0}return this.toArray((function(t){return t.sort(u)})).then(e)}toArray(t){return this._read((t=>{var e=this._ctx;if("next"===e.dir&&Ae(e,!0)&&e.limit>0){const{valueMapper:n}=e,i=Pe(e,e.table.core.schema);return e.table.core.query({trans:t,limit:e.limit,values:!0,query:{index:i,range:e.range}}).then((({result:t})=>n?t.map(n):t))}{const n=[];return je(e,(t=>n.push(t)),t,e.table.core).then((()=>n))}}),t)}offset(t){var e=this._ctx;return t<=0||(e.offset+=t,Ae(e)?Oe(e,(()=>{var e=t;return(t,n)=>0===e||(1===e?(--e,!1):(n((()=>{t.advance(e),e=0})),!1))})):Oe(e,(()=>{var e=t;return()=>--e<0}))),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Oe(this._ctx,(()=>{var e=t;return function(t,n,i){return--e<=0&&n(i),e>=0}}),!0),this}until(t,e){return Ie(this._ctx,(function(n,i,r){return!t(n.value)||(i(r),e)})),this}first(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)}last(t){return this.reverse().first(t)}filter(t){var e,n;return Ie(this._ctx,(function(e){return t(e.value)})),e=this._ctx,n=t,e.isMatch=xe(e.isMatch,n),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.key,n)}))}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.primaryKey,n)}))}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.key)})).then((function(){return n})).then(t)}primaryKeys(t){var e=this._ctx;if("next"===e.dir&&Ae(e,!0)&&e.limit>0)return this._read((t=>{var n=Pe(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:n,range:e.range}})})).then((({result:t})=>t)).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.primaryKey)})).then((function(){return n})).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys((function(t){return t[0]})).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var n={};return Ie(this._ctx,(function(t){var e=t.primaryKey.toString(),i=h(n,e);return n[e]=!0,!i})),this}modify(t){var e=this._ctx;return this._write((n=>{var i;if("function"==typeof t)i=t;else{var r=o(t),s=r.length;i=function(e){for(var n=!1,i=0;i<s;++i){var o=r[i],u=t[o];w(e,o)!==u&&(x(e,o,u),n=!0)}return n}}const u=e.table.core,{outbound:a,extractKey:l}=u.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[];let D=0;const d=[],p=(t,e)=>{const{failures:n,numFailures:i}=e;D+=t-i;for(let t of o(n))h.push(n[t])};return this.clone().primaryKeys().then((r=>{const s=o=>{const h=Math.min(c,r.length-o);return u.getMany({trans:n,keys:r.slice(o,o+h),cache:"immutable"}).then((D=>{const d=[],f=[],g=a?[]:null,m=[];for(let t=0;t<h;++t){const e=D[t],n={value:I(e),primKey:r[o+t]};!1!==i.call(n,n.value,n)&&(null==n.value?m.push(r[o+t]):a||0===Me(l(e),l(n.value))?(f.push(n.value),a&&g.push(r[o+t])):(m.push(r[o+t]),d.push(n.value)))}const y=Ae(e)&&e.limit===1/0&&("function"!=typeof t||t===$e)&&{index:e.index,range:e.range};return Promise.resolve(d.length>0&&u.mutate({trans:n,type:"add",values:d}).then((t=>{for(let e in t.failures)m.splice(parseInt(e),1);p(d.length,t)}))).then((()=>(f.length>0||y&&"object"==typeof t)&&u.mutate({trans:n,type:"put",keys:g,values:f,criteria:y,changeSpec:"function"!=typeof t&&t}).then((t=>p(f.length,t))))).then((()=>(m.length>0||y&&t===$e)&&u.mutate({trans:n,type:"delete",keys:m,criteria:y}).then((t=>p(m.length,t))))).then((()=>r.length>o+h&&s(o+c)))}))};return s(0).then((()=>{if(h.length>0)throw new Q("Error modifying one or more objects",h,D,d);return r.length}))}))}))}delete(){var t=this._ctx,e=t.range;return Ae(t)&&(t.isPrimKey&&!Ce||3===e.type)?this._write((n=>{const{primaryKey:i}=t.table.core.schema,r=e;return t.table.core.count({trans:n,query:{index:i,range:r}}).then((e=>t.table.core.mutate({trans:n,type:"deleteRange",range:r}).then((({failures:t,lastResult:n,results:i,numFailures:r})=>{if(r)throw new Q("Could not delete some values",Object.keys(t).map((e=>t[e])),e-r);return e-r}))))})):this.modify($e)}}const $e=(t,e)=>e.value=null;function He(t,e){return t<e?-1:t===e?0:1}function ze(t,e){return t>e?-1:t===e?0:1}function Ue(t,e,n){var i=t instanceof Xe?new t.Collection(t):t;return i._ctx.error=n?new n(e):new TypeError(e),i}function Ve(t){return new t.Collection(t,(()=>Je(""))).limit(0)}function We(t,e,n,i,r,s){for(var o=Math.min(t.length,i.length),u=-1,a=0;a<o;++a){var l=e[a];if(l!==i[a])return r(t[a],n[a])<0?t.substr(0,a)+n[a]+n.substr(a+1):r(t[a],i[a])<0?t.substr(0,a)+i[a]+n.substr(a+1):u>=0?t.substr(0,u)+e[u]+n.substr(u+1):null;r(t[a],l)<0&&(u=a)}return o<i.length&&"next"===s?t+n.substr(t.length):o<t.length&&"prev"===s?t.substr(0,n.length):u<0?null:t.substr(0,u)+i[u]+n.substr(u+1)}function Ge(t,e,n,i){var r,s,o,u,a,l,c,h=n.length;if(!n.every((t=>"string"==typeof t)))return Ue(t,"String expected.");function D(t){r=function(t){return"next"===t?t=>t.toUpperCase():t=>t.toLowerCase()}(t),s=function(t){return"next"===t?t=>t.toLowerCase():t=>t.toUpperCase()}(t),o="next"===t?He:ze;var e=n.map((function(t){return{lower:s(t),upper:r(t)}})).sort((function(t,e){return o(t.lower,e.lower)}));u=e.map((function(t){return t.upper})),a=e.map((function(t){return t.lower})),l=t,c="next"===t?"":i}D("next");var d=new t.Collection(t,(()=>Ye(u[0],a[h-1]+i)));d._ondirectionchange=function(t){D(t)};var p=0;return d._addAlgorithm((function(t,n,i){var r=t.key;if("string"!=typeof r)return!1;var D=s(r);if(e(D,a,p))return!0;for(var d=null,f=p;f<h;++f){var g=We(r,D,u[f],a[f],o,l);null===g&&null===d?p=f+1:(null===d||o(d,g)>0)&&(d=g)}return n(null!==d?function(){t.continue(d+c)}:i),!1})),d}function Ye(t,e,n,i){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:i}}function Je(t){return{type:1,lower:t,upper:t}}class Xe{get Collection(){return this._ctx.table.db.Collection}between(t,e,n,i){n=!1!==n,i=!0===i;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(n||i)&&(!n||!i)?Ve(this):new this.Collection(this,(()=>Ye(t,e,!n,!i)))}catch(t){return Ue(this,ve)}}equals(t){return null==t?Ue(this,ve):new this.Collection(this,(()=>Je(t)))}above(t){return null==t?Ue(this,ve):new this.Collection(this,(()=>Ye(t,void 0,!0)))}aboveOrEqual(t){return null==t?Ue(this,ve):new this.Collection(this,(()=>Ye(t,void 0,!1)))}below(t){return null==t?Ue(this,ve):new this.Collection(this,(()=>Ye(void 0,t,!1,!0)))}belowOrEqual(t){return null==t?Ue(this,ve):new this.Collection(this,(()=>Ye(void 0,t)))}startsWith(t){return"string"!=typeof t?Ue(this,"String expected."):this.between(t,t+ye,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):Ge(this,((t,e)=>0===t.indexOf(e[0])),[t],ye)}equalsIgnoreCase(t){return Ge(this,((t,e)=>t===e[0]),[t],"")}anyOfIgnoreCase(){var t=q.apply(M,arguments);return 0===t.length?Ve(this):Ge(this,((t,e)=>-1!==e.indexOf(t)),t,"")}startsWithAnyOfIgnoreCase(){var t=q.apply(M,arguments);return 0===t.length?Ve(this):Ge(this,((t,e)=>e.some((e=>0===t.indexOf(e)))),t,ye)}anyOf(){const t=q.apply(M,arguments);let e=this._cmp;try{t.sort(e)}catch(t){return Ue(this,ve)}if(0===t.length)return Ve(this);const n=new this.Collection(this,(()=>Ye(t[0],t[t.length-1])));n._ondirectionchange=n=>{e="next"===n?this._ascending:this._descending,t.sort(e)};let i=0;return n._addAlgorithm(((n,r,s)=>{const o=n.key;for(;e(o,t[i])>0;)if(++i,i===t.length)return r(s),!1;return 0===e(o,t[i])||(r((()=>{n.continue(t[i])})),!1)})),n}notEqual(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=q.apply(M,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return Ue(this,ve)}const e=t.reduce(((t,e)=>t?t.concat([[t[t.length-1][1],e]]):[[-1/0,e]]),null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){const n=this._cmp,i=this._ascending,r=this._descending,s=this._min,o=this._max;if(0===t.length)return Ve(this);if(!t.every((t=>void 0!==t[0]&&void 0!==t[1]&&i(t[0],t[1])<=0)))return Ue(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",nt.InvalidArgument);const u=!e||!1!==e.includeLowers,a=e&&!0===e.includeUppers;let l,c=i;function h(t,e){return c(t[0],e[0])}try{l=t.reduce((function(t,e){let i=0,r=t.length;for(;i<r;++i){const r=t[i];if(n(e[0],r[1])<0&&n(e[1],r[0])>0){r[0]=s(r[0],e[0]),r[1]=o(r[1],e[1]);break}}return i===r&&t.push(e),t}),[]),l.sort(h)}catch(t){return Ue(this,ve)}let D=0;const d=a?t=>i(t,l[D][1])>0:t=>i(t,l[D][1])>=0,p=u?t=>r(t,l[D][0])>0:t=>r(t,l[D][0])>=0;let f=d;const g=new this.Collection(this,(()=>Ye(l[0][0],l[l.length-1][1],!u,!a)));return g._ondirectionchange=t=>{"next"===t?(f=d,c=i):(f=p,c=r),l.sort(h)},g._addAlgorithm(((t,e,n)=>{for(var r=t.key;f(r);)if(++D,D===l.length)return e(n),!1;return!!function(t){return!d(t)&&!p(t)}(r)||(0===this._cmp(r,l[D][1])||0===this._cmp(r,l[D][0])||e((()=>{c===i?t.continue(l[D][0]):t.continue(l[D][1])})),!1)})),g}startsWithAnyOf(){const t=q.apply(M,arguments);return t.every((t=>"string"==typeof t))?0===t.length?Ve(this):this.inAnyRange(t.map((t=>[t,t+ye]))):Ue(this,"startsWithAnyOf() only works with strings")}}function Qe(t){return Jt((function(e){return Ze(e),t(e.target.error),!1}))}function Ze(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const tn=Te(null,"storagemutated");class en{_lock(){return b(!At.global),++this._reculock,1!==this._reculock||At.global||(At.lockOwnerFor=this),this}_unlock(){if(b(!At.global),0==--this._reculock)for(At.global||(At.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{he(t[1],t[0])}catch(t){}}return this}_locked(){return this._reculock&&At.lockOwnerFor!==this}create(t){if(!this.mode)return this;const e=this.db.idbdb,n=this.db._state.dbOpenError;if(b(!this.idbtrans),!t&&!e)switch(n&&n.name){case"DatabaseClosedError":throw new nt.DatabaseClosed(n);case"MissingAPIError":throw new nt.MissingAPI(n.message,n);default:throw new nt.OpenFailed(n)}if(!this.active)throw new nt.TransactionInactive;return b(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Jt((e=>{Ze(e),this._reject(t.error)})),t.onabort=Jt((e=>{Ze(e),this.active&&this._reject(new nt.Abort(t.error)),this.active=!1,this.on("abort").fire(e)})),t.oncomplete=Jt((()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&tn.storagemutated.fire(t.mutatedParts)})),this}_promise(t,e,n){if("readwrite"===t&&"readwrite"!==this.mode)return ge(new nt.ReadOnly("Transaction is readonly"));if(!this.active)return ge(new nt.TransactionInactive);if(this._locked())return new Rt(((i,r)=>{this._blockedFuncs.push([()=>{this._promise(t,e,n).then(i,r)},At])}));if(n)return ie((()=>{var t=new Rt(((t,n)=>{this._lock();const i=e(t,n,this);i&&i.then&&i.then(t,n)}));return t.finally((()=>this._unlock())),t._lib=!0,t}));var i=new Rt(((t,n)=>{var i=e(t,n,this);i&&i.then&&i.then(t,n)}));return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();const n=Rt.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then((()=>n));else{e._waitingFor=n,e._waitingQueue=[];var i=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(i.get(-1/0).onsuccess=t)}()}var r=e._waitingFor;return new Rt(((t,i)=>{n.then((n=>e._waitingQueue.push(Jt(t.bind(null,n)))),(t=>e._waitingQueue.push(Jt(i.bind(null,t))))).finally((()=>{e._waitingFor===r&&(e._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new nt.Abort))}table(t){const e=this._memoizedTables||(this._memoizedTables={});if(h(e,t))return e[t];const n=this.schema[t];if(!n)throw new nt.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,n,this);return i.core=this.db.core.table(t),e[t]=i,i}}function nn(t,e,n,i,r,s,o){return{name:t,keyPath:e,unique:n,multi:i,auto:r,compound:s,src:(n&&!o?"&":"")+(i?"*":"")+(r?"++":"")+rn(e)}}function rn(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function sn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:C(n,(t=>[t.name,t]))}}let on=t=>{try{return t.only([[]]),on=()=>[[]],[[]]}catch(t){return on=()=>ye,ye}};function un(t){return null==t?()=>{}:"string"==typeof t?function(t){return 1===t.split(".").length?e=>e[t]:e=>w(e,t)}(t):e=>w(e,t)}function an(t){return[].slice.call(t)}let ln=0;function cn(t){return null==t?":id":"string"==typeof t?t:`[${t.join("+")}]`}function hn(t,e,n){function i(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:i,lowerOpen:r,upperOpen:s}=t;return void 0===n?void 0===i?null:e.upperBound(i,!!s):void 0===i?e.lowerBound(n,!!r):e.bound(n,i,!!r,!!s)}const{schema:r,hasGetAll:s}=function(t,e){const n=an(t.objectStoreNames);return{schema:{name:t.name,tables:n.map((t=>e.objectStore(t))).map((t=>{const{keyPath:e,autoIncrement:n}=t,i=u(e),r=null==e,s={},o={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:r,compound:i,keyPath:e,autoIncrement:n,unique:!0,extractKey:un(e)},indexes:an(t.indexNames).map((e=>t.index(e))).map((t=>{const{name:e,unique:n,multiEntry:i,keyPath:r}=t,o={name:e,compound:u(r),keyPath:r,unique:n,multiEntry:i,extractKey:un(r)};return s[cn(r)]=o,o})),getIndexByKeyPath:t=>s[cn(t)]};return s[":id"]=o.primaryKey,null!=e&&(s[cn(e)]=o.primaryKey),o}))},hasGetAll:n.length>0&&"getAll"in e.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),o=r.tables.map((t=>function(t){const e=t.name;return{name:e,schema:t,mutate:function({trans:t,type:n,keys:r,values:s,range:o}){return new Promise(((u,a)=>{u=Jt(u);const l=t.objectStore(e),c=null==l.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:D}=r||s||{length:1};if(r&&s&&r.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===D)return u({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const p=[],f=[];let g=0;const m=t=>{++g,Ze(t)};if("deleteRange"===n){if(4===o.type)return u({numFailures:g,failures:f,results:[],lastResult:void 0});3===o.type?p.push(d=l.clear()):p.push(d=l.delete(i(o)))}else{const[t,e]=h?c?[s,r]:[s,null]:[r,null];if(h)for(let i=0;i<D;++i)p.push(d=e&&void 0!==e[i]?l[n](t[i],e[i]):l[n](t[i])),d.onerror=m;else for(let e=0;e<D;++e)p.push(d=l[n](t[e])),d.onerror=m}const y=t=>{const e=t.target.result;p.forEach(((t,e)=>null!=t.error&&(f[e]=t.error))),u({numFailures:g,failures:f,results:"delete"===n?r:p.map((t=>t.result)),lastResult:e})};d.onerror=t=>{m(t),y(t)},d.onsuccess=y}))},getMany:({trans:t,keys:n})=>new Promise(((i,r)=>{i=Jt(i);const s=t.objectStore(e),o=n.length,u=new Array(o);let a,l=0,c=0;const h=t=>{const e=t.target;u[e._pos]=e.result,++c===l&&i(u)},D=Qe(r);for(let t=0;t<o;++t)null!=n[t]&&(a=s.get(n[t]),a._pos=t,a.onsuccess=h,a.onerror=D,++l);0===l&&i(u)})),get:({trans:t,key:n})=>new Promise(((i,r)=>{i=Jt(i);const s=t.objectStore(e).get(n);s.onsuccess=t=>i(t.target.result),s.onerror=Qe(r)})),query:function(t){return n=>new Promise(((r,s)=>{r=Jt(r);const{trans:o,values:u,limit:a,query:l}=n,c=a===1/0?void 0:a,{index:h,range:D}=l,d=o.objectStore(e),p=h.isPrimaryKey?d:d.index(h.name),f=i(D);if(0===a)return r({result:[]});if(t){const t=u?p.getAll(f,c):p.getAllKeys(f,c);t.onsuccess=t=>r({result:t.target.result}),t.onerror=Qe(s)}else{let t=0;const e=u||!("openKeyCursor"in p)?p.openCursor(f):p.openKeyCursor(f),n=[];e.onsuccess=i=>{const s=e.result;return s?(n.push(u?s.value:s.primaryKey),++t===a?r({result:n}):void s.continue()):r({result:n})},e.onerror=Qe(s)}}))}(s),openCursor:function({trans:t,values:n,query:r,reverse:s,unique:o}){return new Promise(((u,a)=>{u=Jt(u);const{index:l,range:c}=r,h=t.objectStore(e),D=l.isPrimaryKey?h:h.index(l.name),d=s?o?"prevunique":"prev":o?"nextunique":"next",p=n||!("openKeyCursor"in D)?D.openCursor(i(c),d):D.openKeyCursor(i(c),d);p.onerror=Qe(a),p.onsuccess=Jt((e=>{const n=p.result;if(!n)return void u(null);n.___id=++ln,n.done=!1;const i=n.continue.bind(n);let r=n.continuePrimaryKey;r&&(r=r.bind(n));const s=n.advance.bind(n),o=()=>{throw new Error("Cursor not stopped")};n.trans=t,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Jt(a),n.next=function(){let t=1;return this.start((()=>t--?this.continue():this.stop())).then((()=>this))},n.start=t=>{const e=new Promise(((t,e)=>{t=Jt(t),p.onerror=Qe(e),n.fail=e,n.stop=e=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=o,t(e)}})),u=()=>{if(p.result)try{t()}catch(t){n.fail(t)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return p.onsuccess=Jt((t=>{p.onsuccess=u,u()})),n.continue=i,n.continuePrimaryKey=r,n.advance=s,u(),e},u(n)}),a)}))},count({query:t,trans:n}){const{index:r,range:s}=t;return new Promise(((t,o)=>{const u=n.objectStore(e),a=r.isPrimaryKey?u:u.index(r.name),l=i(s),c=l?a.count(l):a.count();c.onsuccess=Jt((e=>t(e.target.result))),c.onerror=Qe(o)}))}}}(t))),a={};return o.forEach((t=>a[t.name]=t)),{stack:"dbcore",transaction:t.transaction.bind(t),table(t){if(!a[t])throw new Error(`Table '${t}' not found`);return a[t]},MIN_KEY:-1/0,MAX_KEY:on(e),schema:r}}function Dn({_novip:t},e){const n=e.db,i=function(t,e,{IDBKeyRange:n,indexedDB:i},r){const s=function(t,e){return e.reduce(((t,{create:e})=>({...t,...e(t)})),t)}(hn(e,n,r),t.dbcore);return{dbcore:s}}(t._middlewares,n,t._deps,e);t.core=i.dbcore,t.tables.forEach((e=>{const n=e.name;t.core.schema.tables.some((t=>t.name===n))&&(e.core=t.core.table(n),t[n]instanceof t.Table&&(t[n].core=e.core))}))}function dn({_novip:t},e,n,i){n.forEach((n=>{const r=i[n];e.forEach((e=>{const i=m(e,n);(!i||"value"in i&&void 0===i.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?p(e,n,{get(){return this.table(n)},set(t){d(this,n,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[n]=new t.Table(n,r))}))}))}function pn({_novip:t},e){e.forEach((e=>{for(let n in e)e[n]instanceof t.Table&&delete e[n]}))}function fn(t,e){return t._cfg.version-e._cfg.version}function gn(t,e,n,i){const r=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,r);s.create(n),s._completion.catch(i);const u=s._reject.bind(s),a=At.transless||At;ie((()=>{At.trans=s,At.transless=a,0===e?(o(r).forEach((t=>{yn(n,t,r[t].primKey,r[t].indexes)})),Dn(t,n),Rt.follow((()=>t.on.populate.fire(s))).catch(u)):function({_novip:t},e,n,i){const r=[],s=t._versions;let u=t._dbSchema=Fn(0,t.idbdb,i),a=!1;return s.filter((t=>t._cfg.version>=e)).forEach((s=>{r.push((()=>{const r=u,l=s._cfg.dbschema;bn(t,r,i),bn(t,l,i),u=t._dbSchema=l;const c=mn(r,l);c.add.forEach((t=>{yn(i,t[0],t[1].primKey,t[1].indexes)})),c.change.forEach((t=>{if(t.recreate)throw new nt.Upgrade("Not yet support for changing primary key");{const e=i.objectStore(t.name);t.add.forEach((t=>vn(e,t))),t.change.forEach((t=>{e.deleteIndex(t.name),vn(e,t)})),t.del.forEach((t=>e.deleteIndex(t)))}}));const h=s._cfg.contentUpgrade;if(h&&s._cfg.version>e){Dn(t,i),n._memoizedTables={},a=!0;let e=B(l);c.del.forEach((t=>{e[t]=r[t]})),pn(t,[t.Transaction.prototype]),dn(t,[t.Transaction.prototype],o(e),e),n.schema=e;const s=N(h);let u;s&&re();const D=Rt.follow((()=>{if(u=h(n),u&&s){var t=se.bind(null,null);u.then(t,t)}}));return u&&"function"==typeof u.then?Rt.resolve(u):D.then((()=>u))}})),r.push((e=>{a&&Ee||function(t,e){[].slice.call(e.db.objectStoreNames).forEach((n=>null==t[n]&&e.db.deleteObjectStore(n)))}(s._cfg.dbschema,e),pn(t,[t.Transaction.prototype]),dn(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),n.schema=t._dbSchema}))})),function t(){return r.length?Rt.resolve(r.shift()(n.idbtrans)).then(t):Rt.resolve()}().then((()=>{var t,e;e=i,o(t=u).forEach((n=>{e.db.objectStoreNames.contains(n)||yn(e,n,t[n].primKey,t[n].indexes)}))}))}(t,e,s,n).catch(u)}))}function mn(t,e){const n={del:[],add:[],change:[]};let i;for(i in t)e[i]||n.del.push(i);for(i in e){const r=t[i],s=e[i];if(r){const t={name:i,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||r.primKey.auto!==s.primKey.auto&&!be)t.recreate=!0,n.change.push(t);else{const e=r.idxByName,i=s.idxByName;let o;for(o in e)i[o]||t.del.push(o);for(o in i){const n=e[o],r=i[o];n?n.src!==r.src&&t.change.push(r):t.add.push(r)}(t.del.length>0||t.add.length>0||t.change.length>0)&&n.change.push(t)}}else n.add.push([i,s])}return n}function yn(t,e,n,i){const r=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return i.forEach((t=>vn(r,t))),r}function vn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Fn(t,e,n){const i={};return v(e.objectStoreNames,0).forEach((t=>{const e=n.objectStore(t);let r=e.keyPath;const s=nn(rn(r),r||"",!1,!1,!!e.autoIncrement,r&&"string"!=typeof r,!0),o=[];for(let t=0;t<e.indexNames.length;++t){const n=e.index(e.indexNames[t]);r=n.keyPath;var u=nn(n.name,r,!!n.unique,!!n.multiEntry,!1,r&&"string"!=typeof r,!1);o.push(u)}i[t]=sn(t,s,o)})),i}function bn({_novip:t},e,n){const i=n.db.objectStoreNames;for(let r=0;r<i.length;++r){const s=i[r],o=n.objectStore(s);t._hasGetAll="getAll"in o;for(let t=0;t<o.indexNames.length;++t){const n=o.indexNames[t],i=o.index(n).keyPath,r="string"==typeof i?i:"["+v(i).join("+")+"]";if(e[s]){const t=e[s].idxByName[r];t&&(t.name=n,delete e[s].idxByName[r],e[s].idxByName[n]=t)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class En{_parseStoresSpec(t,e){o(t).forEach((n=>{if(null!==t[n]){var i=t[n].split(",").map(((t,e)=>{const n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return nn(n,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),u(i),0===e)})),r=i.shift();if(r.multi)throw new nt.Schema("Primary key cannot be multi-valued");i.forEach((t=>{if(t.auto)throw new nt.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new nt.Schema("Index must have a name and cannot be an empty string")})),e[n]=sn(n,r,i)}}))}stores(t){const e=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,t):t;const n=e._versions,i={};let r={};return n.forEach((t=>{a(i,t._cfg.storesSource),r=t._cfg.dbschema={},t._parseStoresSpec(i,r)})),e._dbSchema=r,pn(e,[e._allTables,e,e.Transaction.prototype]),dn(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],o(r),r),e._storeNames=o(r),this}upgrade(t){return this._cfg.contentUpgrade=dt(this._cfg.contentUpgrade||st,t),this}}function Cn(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new zn("__dbnames",{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function wn(t){return t&&"function"==typeof t.databases}function xn(t){return ie((function(){return At.letThrough=!0,t()}))}function Bn(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()})).finally((function(){return clearInterval(t)})):Promise.resolve()}function _n(t){var e=e=>t.next(e),n=r(e),i=r((e=>t.throw(e)));function r(t){return e=>{var r=t(e),s=r.value;return r.done?s:s&&"function"==typeof s.then?s.then(n,i):u(s)?Promise.all(s).then(n,i):n(s)}}return r(e)()}function Sn(t,e,n){var i=arguments.length;if(i<2)throw new nt.InvalidArgument("Too few arguments");for(var r=new Array(i-1);--i;)r[i-1]=arguments[i];n=r.pop();var s=S(r);return[t,s,n]}function Tn(t,e,n,i,r){return Rt.resolve().then((()=>{const s=At.transless||At,o=t._createTransaction(e,n,t._dbSchema,i),u={trans:o,transless:s};if(i)o.idbtrans=i.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(i){return i.name===tt.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then((()=>Tn(t,e,n,null,r)))):ge(i)}const a=N(r);let l;a&&re();const c=Rt.follow((()=>{if(l=r.call(o,o),l)if(a){var t=se.bind(null,null);l.then(t,t)}else"function"==typeof l.next&&"function"==typeof l.throw&&(l=_n(l))}),u);return(l&&"function"==typeof l.then?Rt.resolve(l).then((t=>o.active?t:ge(new nt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):c.then((()=>l))).then((t=>(i&&o._resolve(),o._completion.then((()=>t))))).catch((t=>(o._reject(t),ge(t))))}))}function kn(t,e,n){const i=u(t)?t.slice():[t];for(let t=0;t<n;++t)i.push(e);return i}const An={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:i}=n,r={},s=[];function o(t,e,n){const i=cn(t),u=r[i]=r[i]||[],a=null==t?0:"string"==typeof t?1:t.length,l=e>0,c={...n,isVirtual:l,keyTail:e,keyLength:a,extractKey:un(t),unique:!l&&n.unique};return u.push(c),c.isPrimaryKey||s.push(c),a>1&&o(2===a?t[0]:t.slice(0,a-1),e+1,n),u.sort(((t,e)=>t.keyTail-e.keyTail)),c}const u=o(i.primaryKey.keyPath,0,i.primaryKey);r[":id"]=[u];for(const t of i.indexes)o(t.keyPath,0,t);function a(e){const n=e.query.index;return n.isVirtual?{...e,query:{index:n,range:(i=e.query.range,r=n.keyTail,{type:1===i.type?2:i.type,lower:kn(i.lower,i.lowerOpen?t.MAX_KEY:t.MIN_KEY,r),lowerOpen:!0,upper:kn(i.upper,i.upperOpen?t.MIN_KEY:t.MAX_KEY,r),upperOpen:!0})}}:e;var i,r}const l={...n,schema:{...i,primaryKey:u,indexes:s,getIndexByKeyPath:function(t){const e=r[cn(t)];return e&&e[0]}},count:t=>n.count(a(t)),query:t=>n.query(a(t)),openCursor(e){const{keyTail:i,isVirtual:r,keyLength:s}=e.query.index;return r?n.openCursor(a(e)).then((n=>n&&function(n){const r=Object.create(n,{continue:{value:function(r){null!=r?n.continue(kn(r,e.reverse?t.MAX_KEY:t.MIN_KEY,i)):e.unique?n.continue(n.key.slice(0,s).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value(e,r){n.continuePrimaryKey(kn(e,t.MAX_KEY,i),r)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const t=n.key;return 1===s?t[0]:t.slice(0,s)}},value:{get:()=>n.value}});return r}(n))):n.openCursor(e)}};return l}}}};function In(t,e,n,i){return n=n||{},i=i||"",o(t).forEach((r=>{if(h(e,r)){var s=t[r],o=e[r];if("object"==typeof s&&"object"==typeof o&&s&&o){const t=R(s);t!==R(o)?n[i+r]=e[r]:"Object"===t?In(s,o,n,i+r+"."):s!==o&&(n[i+r]=e[r])}else s!==o&&(n[i+r]=e[r])}else n[i+r]=void 0})),o(e).forEach((r=>{h(t,r)||(n[i+r]=e[r])})),n}const On={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:i}=n.schema,r={...n,mutate(t){const r=At.trans,{deleting:s,creating:o,updating:u}=r.table(e).hook;switch(t.type){case"add":if(o.fire===st)break;return r._promise("readwrite",(()=>a(t)),!0);case"put":if(o.fire===st&&u.fire===st)break;return r._promise("readwrite",(()=>a(t)),!0);case"delete":if(s.fire===st)break;return r._promise("readwrite",(()=>a(t)),!0);case"deleteRange":if(s.fire===st)break;return r._promise("readwrite",(()=>function(t){return l(t.trans,t.range,1e4)}(t)),!0)}return n.mutate(t);function a(t){const e=At.trans,r=t.keys||function(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}(i,t);if(!r)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?{...t,keys:r}:{...t}).type&&(t.values=[...t.values]),t.keys&&(t.keys=[...t.keys]),function(t,e,n){return"add"===e.type?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}(n,t,r).then((a=>{const l=r.map(((n,r)=>{const l=a[r],c={onerror:null,onsuccess:null};if("delete"===t.type)s.fire.call(c,n,l,e);else if("add"===t.type||void 0===l){const s=o.fire.call(c,n,t.values[r],e);null==n&&null!=s&&(n=s,t.keys[r]=n,i.outbound||x(t.values[r],i.keyPath,n))}else{const i=In(l,t.values[r]),s=u.fire.call(c,i,n,l,e);if(s){const e=t.values[r];Object.keys(s).forEach((t=>{h(e,t)?e[t]=s[t]:x(e,t,s[t])}))}}return c}));return n.mutate(t).then((({failures:e,results:n,numFailures:i,lastResult:s})=>{for(let i=0;i<r.length;++i){const s=n?n[i]:r[i],o=l[i];null==s?o.onerror&&o.onerror(e[i]):o.onsuccess&&o.onsuccess("put"===t.type&&a[i]?t.values[i]:s)}return{failures:e,results:n,numFailures:i,lastResult:s}})).catch((t=>(l.forEach((e=>e.onerror&&e.onerror(t))),Promise.reject(t))))}))}function l(t,e,r){return n.query({trans:t,values:!1,query:{index:i,range:e},limit:r}).then((({result:n})=>a({type:"delete",keys:n,trans:t}).then((i=>i.numFailures>0?Promise.reject(i.failures[0]):n.length<r?{failures:[],numFailures:0,lastResult:void 0}:l(t,{...e,lower:n[n.length-1],lowerOpen:!0},r)))))}}};return r}})};function Pn(t,e,n){try{if(!e)return null;if(e.keys.length<t.length)return null;const i=[];for(let r=0,s=0;r<e.keys.length&&s<t.length;++r)0===Me(e.keys[r],t[s])&&(i.push(n?I(e.values[r]):e.values[r]),++s);return i.length===t.length?i:null}catch(t){return null}}const Rn={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:t=>{if(!t.cache)return n.getMany(t);const e=Pn(t.keys,t.trans._cache,"clone"===t.cache);return e?Rt.resolve(e):n.getMany(t).then((e=>(t.trans._cache={keys:t.keys,values:"clone"===t.cache?I(e):e},e)))},mutate:t=>("add"!==t.type&&(t.trans._cache=null),n.mutate(t))}}})};function jn(t){return!("from"in t)}const Kn=function(t,e){if(!this){const e=new Kn;return t&&"d"in t&&a(e,t),e}a(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Mn(t,e,n){const i=Me(e,n);if(isNaN(i))return;if(i>0)throw RangeError();if(jn(t))return a(t,{from:e,to:n,d:1});const r=t.l,s=t.r;if(Me(n,t.from)<0)return r?Mn(r,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Ln(t);if(Me(e,t.to)>0)return s?Mn(s,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Ln(t);Me(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),Me(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const o=!t.r;r&&!t.l&&qn(t,r),s&&o&&qn(t,s)}function qn(t,e){jn(e)||function t(e,{from:n,to:i,l:r,r:s}){Mn(e,n,i),r&&t(e,r),s&&t(e,s)}(t,e)}function Nn(t){let e=jn(t)?null:{s:0,n:t};return{next(t){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Me(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Me(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Ln(t){var e,n;const i=((null===(e=t.r)||void 0===e?void 0:e.d)||0)-((null===(n=t.l)||void 0===n?void 0:n.d)||0),r=i>1?"r":i<-1?"l":"";if(r){const e="r"===r?"l":"r",n={...t},i=t[r];t.from=i.from,t.to=i.to,t[r]=i[r],n[r]=i[e],t[e]=n,n.d=$n(n)}t.d=$n(t)}function $n({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}D(Kn.prototype,{add(t){return qn(this,t),this},addKey(t){return Mn(this,t,t),this},addKeys(t){return t.forEach((t=>Mn(this,t,t))),this},[j](){return Nn(this)}});const Hn={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new Kn(t.MIN_KEY,t.MAX_KEY);return{...t,table:i=>{const r=t.table(i),{schema:s}=r,{primaryKey:a}=s,{extractKey:l,outbound:c}=a,h={...r,mutate:t=>{const o=t.trans,a=o.mutatedParts||(o.mutatedParts={}),l=t=>{const n=`idb://${e}/${i}/${t}`;return a[n]||(a[n]=new Kn)},c=l(""),h=l(":dels"),{type:D}=t;let[d,p]="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[[],t.values]:[];const f=t.trans._cache;return r.mutate(t).then((t=>{if(u(d)){"delete"!==D&&(d=t.results),c.addKeys(d);const e=Pn(d,f);e||"add"===D||h.addKeys(d),(e||p)&&function(t,e,n,i){e.indexes.forEach((function(e){const r=t(e.name||"");function s(t){return null!=t?e.extractKey(t):null}const o=t=>e.multiEntry&&u(t)?t.forEach((t=>r.addKey(t))):r.addKey(t);(n||i).forEach(((t,e)=>{const r=n&&s(n[e]),u=i&&s(i[e]);0!==Me(r,u)&&(null!=r&&o(r),null!=u&&o(u))}))}))}(l,s,e,p)}else if(d){const t={from:d.lower,to:d.upper};h.add(t),c.add(t)}else c.add(n),h.add(n),s.indexes.forEach((t=>l(t.name).add(n)));return t}))}},D=({query:{index:e,range:n}})=>{var i,r;return[e,new Kn(null!==(i=n.lower)&&void 0!==i?i:t.MIN_KEY,null!==(r=n.upper)&&void 0!==r?r:t.MAX_KEY)]},d={get:t=>[a,new Kn(t.key)],getMany:t=>[a,(new Kn).addKeys(t.keys)],count:D,query:D,openCursor:D};return o(d).forEach((t=>{h[t]=function(s){const{subscr:o}=At;if(o){const u=t=>{const n=`idb://${e}/${i}/${t}`;return o[n]||(o[n]=new Kn)},a=u(""),h=u(":dels"),[D,p]=d[t](s);if(u(D.name||"").add(p),!D.isPrimaryKey){if("count"!==t){const e="query"===t&&c&&s.values&&r.query({...s,values:!1});return r[t].apply(this,arguments).then((n=>{if("query"===t){if(c&&s.values)return e.then((({result:t})=>(a.addKeys(t),n)));const t=s.values?n.result.map(l):n.result;s.values?a.addKeys(t):h.addKeys(t)}else if("openCursor"===t){const t=n,e=s.values;return t&&Object.create(t,{key:{get:()=>(h.addKey(t.primaryKey),t.key)},primaryKey:{get(){const e=t.primaryKey;return h.addKey(e),e}},value:{get:()=>(e&&a.addKey(t.primaryKey),t.value)}})}return n}))}h.add(n)}}return r[t].apply(this,arguments)}})),h}}}};class zn{constructor(t,e){this._middlewares={},this.verno=0;const n=zn.dependencies;this._options=e={addons:zn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...e},this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};const{addons:i}=e;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const r={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:st,dbReadyPromise:null,cancelOpen:st,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var s;r.dbReadyPromise=new Rt((t=>{r.dbReadyResolve=t})),r.openCanceller=new Rt(((t,e)=>{r.cancelOpen=e})),this._state=r,this.name=t,this.on=Te(this,"populate","blocked","versionchange","close",{ready:[dt,st]}),this.on.ready.subscribe=F(this.on.ready.subscribe,(t=>(e,n)=>{zn.vip((()=>{const i=this._state;if(i.openComplete)i.dbOpenError||Rt.resolve().then(e),n&&t(e);else if(i.onReadyBeingFired)i.onReadyBeingFired.push(e),n&&t(e);else{t(e);const i=this;n||t((function t(){i.on.ready.unsubscribe(e),i.on.ready.unsubscribe(t)}))}}))})),this.Collection=(s=this,ke(Le.prototype,(function(t,e){this.db=s;let n=Be,i=null;if(e)try{n=e()}catch(t){i=t}const r=t._ctx,o=r.table,u=o.hook.reading.fire;this._ctx={table:o,index:r.index,isPrimKey:!r.index||o.schema.primKey.keyPath&&r.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:r.or,valueMapper:u!==ot?u:null}}))),this.Table=function(t){return ke(Se.prototype,(function(e,n,i){this.db=t,this._tx=i,this.name=e,this.schema=n,this.hook=t._allTables[e]?t._allTables[e].hook:Te(null,{creating:[lt,st],reading:[ut,ot],updating:[ht,st],deleting:[ct,st]})}))}(this),this.Transaction=function(t){return ke(en.prototype,(function(e,n,i,r,s){this.db=t,this.mode=e,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=Te(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Rt(((t,e)=>{this._resolve=t,this._reject=e})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(t=>{var e=this.active;return this.active=!1,this.on.error.fire(t),this.parent?this.parent._reject(t):e&&this.idbtrans&&this.idbtrans.abort(),ge(t)}))}))}(this),this.Version=function(t){return ke(En.prototype,(function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(t){return ke(Xe.prototype,(function(e,n,i){this.db=t,this._ctx={table:e,index:":id"===n?null:n,or:i};const r=t._deps.indexedDB;if(!r)throw new nt.MissingAPI;this._cmp=this._ascending=r.cmp.bind(r),this._descending=(t,e)=>r.cmp(e,t),this._max=(t,e)=>r.cmp(t,e)>0?t:e,this._min=(t,e)=>r.cmp(t,e)<0?t:e,this._IDBKeyRange=t._deps.IDBKeyRange}))}(this),this.on("versionchange",(t=>{t.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(t=>{!t.newVersion||t.newVersion<t.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${t.oldVersion/10}`)})),this._maxKey=on(e.IDBKeyRange),this._createTransaction=(t,e,n,i)=>new this.Transaction(t,e,n,this._options.chromeTransactionDurability,i),this._fireOnBlocked=t=>{this.on("blocked").fire(t),Fe.filter((t=>t.name===this.name&&t!==this&&!t._state.vcFired)).map((e=>e.on("versionchange").fire(t)))},this.use(An),this.use(On),this.use(Hn),this.use(Rn),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach((t=>t(this)))}version(t){if(isNaN(t)||t<.1)throw new nt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new nt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const e=this._versions;var n=e.filter((e=>e._cfg.version===t))[0];return n||(n=new this.Version(t),e.push(n),e.sort(fn),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(t){return this.idbdb&&(this._state.openComplete||At.letThrough||this._vip)?t():new Rt(((t,e)=>{if(this._state.openComplete)return e(new nt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void e(new nt.DatabaseClosed);this.open().catch(st)}this._state.dbReadyPromise.then(t,e)})).then(t)}use({stack:t,create:e,level:n,name:i}){i&&this.unuse({stack:t,name:i});const r=this._middlewares[t]||(this._middlewares[t]=[]);return r.push({stack:t,create:e,level:null==n?10:n,name:i}),r.sort(((t,e)=>t.level-e.level)),this}unuse({stack:t,name:e,create:n}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((t=>n?t.create!==n:!!e&&t.name!==e))),this}open(){return function(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((()=>e.dbOpenError?ge(e.dbOpenError):t));L&&(e.openCanceller._stackHolder=U()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const i=e.openCanceller;function r(){if(e.openCanceller!==i)throw new nt.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,u=null,a=!1;return Rt.race([i,("undefined"==typeof navigator?Rt.resolve():Bn()).then((()=>new Rt(((i,s)=>{if(r(),!n)throw new nt.MissingAPI;const l=t.name,c=e.autoSchema?n.open(l):n.open(l,Math.round(10*t.verno));if(!c)throw new nt.MissingAPI;c.onerror=Qe(s),c.onblocked=Jt(t._fireOnBlocked),c.onupgradeneeded=Jt((i=>{if(u=c.transaction,e.autoSchema&&!t._options.allowEmptyDB){c.onerror=Ze,u.abort(),c.result.close();const t=n.deleteDatabase(l);t.onsuccess=t.onerror=Jt((()=>{s(new nt.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{u.onerror=Qe(s);var r=i.oldVersion>Math.pow(2,62)?0:i.oldVersion;a=r<1,t._novip.idbdb=c.result,gn(t,r/10,u,s)}}),s),c.onsuccess=Jt((()=>{u=null;const n=t._novip.idbdb=c.result,r=v(n.objectStoreNames);if(r.length>0)try{const i=n.transaction(1===(s=r).length?s[0]:s,"readonly");e.autoSchema?function({_novip:t},e,n){t.verno=e.version/10;const i=t._dbSchema=Fn(0,e,n);t._storeNames=v(e.objectStoreNames,0),dn(t,[t._allTables],o(i),i)}(t,n,i):(bn(t,t._dbSchema,i),function(t,e){const n=mn(Fn(0,t.idbdb,e),t._dbSchema);return!(n.add.length||n.change.some((t=>t.add.length||t.change.length)))}(t,i)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Dn(t,i)}catch(t){}var s;Fe.push(t),n.onversionchange=Jt((n=>{e.vcFired=!0,t.on("versionchange").fire(n)})),n.onclose=Jt((e=>{t.on("close").fire(e)})),a&&function({indexedDB:t,IDBKeyRange:e},n){!wn(t)&&"__dbnames"!==n&&Cn(t,e).put({name:n}).catch(st)}(t._deps,l),i()}),s)}))))]).then((()=>(r(),e.onReadyBeingFired=[],Rt.resolve(xn((()=>t.on.ready.fire(t.vip)))).then((function n(){if(e.onReadyBeingFired.length>0){let i=e.onReadyBeingFired.reduce(dt,st);return e.onReadyBeingFired=[],Rt.resolve(xn((()=>i(t.vip)))).then(n)}}))))).finally((()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1})).then((()=>t)).catch((n=>{e.dbOpenError=n;try{u&&u.abort()}catch(t){}return i===e.openCanceller&&t._close(),ge(n)})).finally((()=>{e.openComplete=!0,s()}))}(this)}_close(){const t=this._state,e=Fe.indexOf(this);if(e>=0&&Fe.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(t){}this._novip.idbdb=null}t.dbReadyPromise=new Rt((e=>{t.dbReadyResolve=e})),t.openCanceller=new Rt(((e,n)=>{t.cancelOpen=n}))}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new nt.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,e=this._state;return new Rt(((n,i)=>{const r=()=>{this.close();var t=this._deps.indexedDB.deleteDatabase(this.name);t.onsuccess=Jt((()=>{!function({indexedDB:t,IDBKeyRange:e},n){!wn(t)&&"__dbnames"!==n&&Cn(t,e).delete(n).catch(st)}(this._deps,this.name),n()})),t.onerror=Qe(i),t.onblocked=this._fireOnBlocked};if(t)throw new nt.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(r):r()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return o(this._allTables).map((t=>this._allTables[t]))}transaction(){const t=Sn.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,e,n){let i=At.trans;i&&i.db===this&&-1===t.indexOf("!")||(i=null);const r=-1!==t.indexOf("?");let s,o;t=t.replace("!","").replace("?","");try{if(o=e.map((t=>{var e=t instanceof this.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==t||"readonly"===t)s="readonly";else{if("rw"!=t&&"readwrite"!=t)throw new nt.InvalidArgument("Invalid transaction mode: "+t);s="readwrite"}if(i){if("readonly"===i.mode&&"readwrite"===s){if(!r)throw new nt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach((t=>{if(i&&-1===i.storeNames.indexOf(t)){if(!r)throw new nt.SubTransaction("Table "+t+" not included in parent transaction.");i=null}})),r&&i&&!i.active&&(i=null)}}catch(t){return i?i._promise(null,((e,n)=>{n(t)})):ge(t)}const u=Tn.bind(null,this,s,o,i,n);return i?i._promise(s,u,"lock"):At.trans?he(At.transless,(()=>this._whenReady(u))):this._whenReady(u)}table(t){if(!h(this._allTables,t))throw new nt.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Un="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Vn{constructor(t){this._subscribe=t}subscribe(t,e,n){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:e,complete:n})}[Un](){return this}}function Wn(t,e){return o(e).forEach((n=>{qn(t[n]||(t[n]=new Kn),e[n])})),t}let Gn;try{Gn={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch(s){Gn={indexedDB:null,IDBKeyRange:null}}const Yn=zn;function Jn(t){let e=Xn;try{Xn=!0,tn.storagemutated.fire(t)}finally{Xn=e}}D(Yn,{...rt,delete:t=>new Yn(t,{addons:[]}).delete(),exists:t=>new Yn(t,{addons:[]}).open().then((t=>(t.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(t){try{return function({indexedDB:t,IDBKeyRange:e}){return wn(t)?Promise.resolve(t.databases()).then((t=>t.map((t=>t.name)).filter((t=>"__dbnames"!==t)))):Cn(t,e).toCollection().primaryKeys()}(Yn.dependencies).then(t)}catch(t){return ge(new nt.MissingAPI)}},defineClass:()=>function(t){a(this,t)},ignoreTransaction:t=>At.trans?he(At.transless,t):t(),vip:xn,async:function(t){return function(){try{var e=_n(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Rt.resolve(e)}catch(t){return ge(t)}}},spawn:function(t,e,n){try{var i=_n(t.apply(n,e||[]));return i&&"function"==typeof i.then?i:Rt.resolve(i)}catch(t){return ge(t)}},currentTransaction:{get:()=>At.trans||null},waitFor:function(t,e){const n=Rt.resolve("function"==typeof t?Yn.ignoreTransaction(t):t).timeout(e||6e4);return At.trans?At.trans.waitFor(n):n},Promise:Rt,debug:{get:()=>L,set:t=>{$(t,"dexie"===t?()=>!0:we)}},derive:f,extend:a,props:D,override:F,Events:Te,on:tn,liveQuery:function(t){return new Vn((e=>{const n=N(t);let i=!1,r={},s={};const u={get closed(){return i},unsubscribe:()=>{i=!0,tn.storagemutated.unsubscribe(h)}};e.start&&e.start(u);let a=!1,l=!1;function c(){return o(s).some((t=>r[t]&&function(t,e){const n=Nn(e);let i=n.next();if(i.done)return!1;let r=i.value;const s=Nn(t);let o=s.next(r.from),u=o.value;for(;!i.done&&!o.done;){if(Me(u.from,r.to)<=0&&Me(u.to,r.from)>=0)return!0;Me(r.from,u.from)<0?r=(i=n.next(u.from)).value:u=(o=s.next(r.from)).value}return!1}(r[t],s[t])))}const h=t=>{Wn(r,t),c()&&D()},D=()=>{if(a||i)return;r={};const o={},d=function(e){n&&re();const i=()=>ie(t,{subscr:e,trans:null}),r=At.trans?he(At.transless,i):i();return n&&r.then(se,se),r}(o);l||(tn("storagemutated",h),l=!0),a=!0,Promise.resolve(d).then((t=>{a=!1,i||(c()?D():(r={},s=o,e.next&&e.next(t)))}),(t=>{a=!1,e.error&&e.error(t),u.unsubscribe()}))};return D(),u}))},extendObservabilitySet:Wn,getByKeyPath:w,setByKeyPath:x,delByKeyPath:function(t,e){"string"==typeof e?x(t,e,void 0):"length"in e&&[].map.call(e,(function(e){x(t,e,void 0)}))},shallowClone:B,deepClone:I,getObjectDiff:In,cmp:Me,asap:E,minKey:-1/0,addons:[],connections:Fe,errnames:tt,dependencies:Gn,semVer:"3.2.2",version:"3.2.2".split(".").map((t=>parseInt(t))).reduce(((t,e,n)=>t+e/Math.pow(10,2*n)))}),Yn.maxKey=on(Yn.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(tn("storagemutated",(t=>{if(!Xn){let e;be?(e=document.createEvent("CustomEvent"),e.initCustomEvent("x-storagemutated-1",!0,!0,t)):e=new CustomEvent("x-storagemutated-1",{detail:t}),Xn=!0,dispatchEvent(e),Xn=!1}})),addEventListener("x-storagemutated-1",(({detail:t})=>{Xn||Jn(t)})));let Xn=!1;if("undefined"!=typeof BroadcastChannel){const t=new BroadcastChannel("x-storagemutated-1");tn("storagemutated",(e=>{Xn||t.postMessage(e)})),t.onmessage=t=>{t.data&&Jn(t.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){tn("storagemutated",(t=>{try{Xn||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((e=>e.postMessage({type:"x-storagemutated-1",changedParts:t}))))}catch(t){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(t=>{if("x-storagemutated-1"===t.key){const e=JSON.parse(t.newValue);e&&Jn(e.changedParts)}}));const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",(function({data:t}){t&&"x-storagemutated-1"===t.type&&Jn(t.changedParts)}))}Rt.rejectionMapper=function(t,e){if(!t||t instanceof J||t instanceof TypeError||t instanceof SyntaxError||!t.name||!it[t.name])return t;var n=new it[t.name](e||t.message,t);return"stack"in t&&p(n,"stack",{get:function(){return this.inner.stack}}),n},$(L,we);var Qn,Zn=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))};!function(t){t[t.construstoring=0]="construstoring",t[t.initing=1]="initing",t[t.updating=2]="updating",t[t.connecting=3]="connecting",t[t.close=4]="close",t[t.opening=5]="opening"}(Qn||(Qn={}));class ti{constructor(t,e,n){this.dataBaseName="transfer-core",this.status=Qn.construstoring,this.dataBaseName=null!=t?t:"transfer-core",this.dbConfig=null!=e?e:{schema:{users:"id",messages:"id",outgoingMessages:"id",translateSetting:"id"}},!1===n?zn.exists(this.dataBaseName).then((t=>{console.log("dbexist ====>",t),t&&(this.db=new zn(this.dataBaseName,{allowEmptyDB:null==n||n}),this.eventEmitter=new r,this.initDB())})):(this.db=new zn(this.dataBaseName,{allowEmptyDB:null==n||n}),this.eventEmitter=new r,this.initDB())}getVersion(){return Zn(this,void 0,void 0,(function*(){if(this.db.isOpen())return this.db.verno;try{yield this.db.open()}finally{return this.db.verno}}))}initDB(){var t;return Zn(this,void 0,void 0,(function*(){this.status=Qn.initing;const e=yield this.getVersion();yield this.closeDB(),this.db.version(0==e?3:e).stores(null===(t=this.dbConfig)||void 0===t?void 0:t.schema),yield this.db.open(),this.status=Qn.connecting,this.eventEmitter.emit("statusChangedToConnecting")}))}openDB(){return Zn(this,void 0,void 0,(function*(){if(!this.db.isOpen()){try{yield this.db.open()}finally{}this.status=Qn.opening}}))}closeDB(){return Zn(this,void 0,void 0,(function*(){if(this.db.isOpen()){try{yield this.db.close()}finally{}this.status=Qn.close}}))}addTable(t,e){return Zn(this,void 0,void 0,(function*(){this.status=Qn.updating;const n=yield this.getVersion();yield this.closeDB(),this.dbConfig.schema[t]=null!=e?e:"id",this.db=new zn(this.dataBaseName),this.db.version(n+1).stores(this.dbConfig.schema),yield this.openDB(),this.status=Qn.connecting,this.eventEmitter.emit("statusChangedToConnecting")}))}waitStatusConnecting(){return Zn(this,void 0,void 0,(function*(){return new Promise((t=>{this.status!==Qn.connecting?this.eventEmitter.once("statusChangedToConnecting",(()=>{t()})):t()}))}))}checkTableExist(t){return Zn(this,void 0,void 0,(function*(){yield this.waitStatusConnecting();try{this.db.table(t)}catch(e){yield this.addTable(t)}}))}updateOneById(t,e){return Zn(this,void 0,void 0,(function*(){try{yield this.checkTableExist(t);const n=yield this.findOneById(t,null==e?void 0:e.id);n?yield this.db.table(t).put(Object.assign(Object.assign({},n),e)):yield this.db.table(t).add(e)}finally{}}))}findOneById(t,e){return Zn(this,void 0,void 0,(function*(){try{return yield this.checkTableExist(t),yield this.db.table(t).get({id:e})}catch(t){return}}))}findAll(t){return Zn(this,void 0,void 0,(function*(){try{return yield this.checkTableExist(t),yield this.db.table(t).toArray()}catch(t){return}}))}}var ei=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))};class ni{constructor(){this.indexDB=new ti,this.ramDB={messages:[],keys:new Map,size:0},this.findAllMessages()}findAllMessages(){return ei(this,void 0,void 0,(function*(){const t=yield this.indexDB.findAll("messages");this.ramDB.messages=t;const e=this.ramDB.keys;null==t||t.forEach(((t,n)=>{e.set(null==t?void 0:t.id,n)})),this.ramDB.size=t.length}))}updateOneById(t,e){return ei(this,void 0,void 0,(function*(){"messages"===t&&this.updateMessagesById(e),yield this.indexDB.updateOneById(t,e)}))}findMessagesById(t){const e=this.ramDB.keys.get(t);return this.ramDB.messages[e]}updateMessagesById(t){const e=this.ramDB.keys.get(null==t?void 0:t.id);e?this.ramDB.messages[e]=t:(this.ramDB.messages[this.ramDB.size]=t,this.ramDB.keys.set(null==t?void 0:t.id,this.ramDB.size),this.ramDB.size=this.ramDB.size+1)}findOneById(t,e){if("messages"===t){const t=this.findMessagesById(e);if(t)return t}return this.indexDB.findOneById(t,e)}}var ii=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))};class ri{constructor(){if(ri._instance)throw new Error("Error: Instantiation failed: Use DataStore.getInstance() instead of new.");ri._instance=this,this.db=new ni,this.eventEmitter=new r}static getInstance(){return ri._instance||(ri._instance=new ri),ri._instance}updateOne(t,e){return ii(this,void 0,void 0,(function*(){yield this.db.updateOneById(t,e),this.emit(t)}))}subscribe(t,e,n){const i=()=>{this.db.findOneById(t,e).then((t=>{n(t)}))};i(),this.eventEmitter.on(t,i)}findOne(t,e){return ii(this,void 0,void 0,(function*(){return yield this.db.findOneById(t,e)}))}emit(t){this.eventEmitter.emit(t),this.eventEmitter.emit("all")}}var si=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))};const oi=n(809),ui=t=>t?e.V.hashStr(t.replace(/ /g,"").replace(/ /g,"")):"",ai=t=>t?window.btoa(unescape(encodeURIComponent(t))):"",li=(t,e,n)=>{ri.getInstance().updateOne("messages",{id:t,text:e,translation:n})},ci=t=>{let e="",n=[];if(t){const i=oi();let r=0;for(const s of t.matchAll(i)){const i=s[0],o=s.index,u=s.index+i.length;n.push({value:i,length:i.length,start:o,end:u}),e+=t.slice(r,o),r=u}e+=t.slice(r,t.length)}return{text:e,emoji:n}};var hi=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))};const Di=({text:e,setting:n,forceReload:i,isGroup:r,noIndexDBDataReturn:s=!1})=>hi(void 0,void 0,void 0,(function*(){var o,u,a,l;if(!e)return{status:"SUCCESS",translateText:""};const c=ui(null===(o=ci(e))||void 0===o?void 0:o.text);if(!i){const t=yield(t=>si(void 0,void 0,void 0,(function*(){return yield ri.getInstance().findOne("messages",t)})))(c);if(t)return{status:"SUCCESS",translateText:null==t?void 0:t.translation};if(s)return{status:"SUCCESS",translateText:"历史不翻译"};if(r&&!(null==n?void 0:n.groupAutoTransfer))return{status:"SUCCESS",translateText:"不翻译群"};if(!n.autoTransfer)return{status:"SUCCESS",translateText:"不自动翻译"}}try{const i=yield t(n.domain,n.token,{q:ai(e),from:n.from,to:n.to,type:0,reqid:6},n.mainFetch.income);if(!(null==i?void 0:i.data)&&(null==i?void 0:i.msg))throw new Error(null==i?void 0:i.msg);return li(c,e,null===(u=null==i?void 0:i.data)||void 0===u?void 0:u.translation),{status:"SUCCESS",translateText:null===(a=null==i?void 0:i.data)||void 0===a?void 0:a.translation}}catch(t){return console.log("error ===>",t),{status:"FAIL",translateText:(null===(l=null==t?void 0:t.toString())||void 0===l?void 0:l.length)<30?`${t}`:"翻译失败"}}})),di=({text:e,setting:n,settingEntity:i})=>hi(void 0,void 0,void 0,(function*(){return 1!=(null==n?void 0:n.sendAuto)?e:e?yield new Promise(((r,s)=>hi(void 0,void 0,void 0,(function*(){var o,u,a,l,c,h,D,d;setTimeout((()=>{s("time out")}),1e4);const p=yield(f=ui(e),si(void 0,void 0,void 0,(function*(){return yield ri.getInstance().findOne("outgoingMessages",f)})));var f;if(p&&p.to==n.outgoingTo)return r(null==p?void 0:p.translation),void console.log(p);li(ui(e),e,e),console.log(e);try{const p=yield t(n.domain,n.token,{q:ai(e),from:"auto",to:n.outgoingTo,type:0,reqid:6},n.mainFetch.outgoing);if(console.log(p),!(null===(o=null==p?void 0:p.data)||void 0===o?void 0:o.translation))return null===(u=null==i?void 0:i.eventEmitter)||void 0===u||u.emit("error",null!==(a=null==p?void 0:p.msg)&&void 0!==a?a:"翻译失败，无数据返回"),void s("no message");const f=ui(null===(c=ci(null===(l=null==p?void 0:p.data)||void 0===l?void 0:l.translation))||void 0===c?void 0:c.text);li(f,null===(h=null==p?void 0:p.data)||void 0===h?void 0:h.translation,e),((t,e,n,i)=>{ri.getInstance().updateOne("outgoingMessages",{id:t,text:e,translation:n,to:i})})(ui(e),e,null===(D=null==p?void 0:p.data)||void 0===D?void 0:D.translation,n.outgoingTo),r(null===(d=null==p?void 0:p.data)||void 0===d?void 0:d.translation)}catch(t){console.log(t),s("TranslateError")}})))):e})),pi={0:{color:"white",backgroundColor:"green"},1:{color:"white",backgroundColor:"rgba(45, 136, 255)"},2:{color:"white",backgroundColor:"#000000"},3:{color:"#000000",backgroundColor:"yellow"},4:{color:"#000000",backgroundColor:"orange"},5:{color:"#000000",backgroundColor:"gray"},6:{color:"#000000",backgroundColor:"red"},7:{color:"#000000",backgroundColor:"purple"},8:{color:"#000000",backgroundColor:"white"}};const fi=class{constructor(t){var e,n,i;this.setting=t.setting,this.text=t.text,this.innerTextStart=t.innerTextStart,this.type=t.type,this.transferText="";const r=this.setting.otherSettings.document.createElement("div");this.fragment=r,r.setAttribute("class","trans-item selectable-text copyable-text"),r.setAttribute("style",`font-size: ${null!==(e=this.setting.translateSetting.fontSize)&&void 0!==e?e:"12px"};\n    color: ${null!==(i=null===(n=pi[this.setting.translateSetting.styleType])||void 0===n?void 0:n.color)&&void 0!==i?i:"white"};\n    width: 100%;\n  display: block;\n    height: 100%;\n    opacity: 1;`),r.appendChild(this.renderContainer()),this.getTransferText(),this.setting.subscribe("updateTranslateSetting",(()=>{this.updateSizeAndColor()}))}getTransferText(t){return function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){}))}changeToLoading(){this.transferText="loading...",this.updateText()}get transferDom(){return this.fragment.querySelector(`.${this.type}-text`)}updateText(){this.transferDom&&(this.transferDom.innerText=`${this.innerTextStart} : ${this.transferText}`)}updateSizeAndColor(){var t,e,n,i,r;try{this.fragment&&(this.fragment.style.fontSize=null!==(t=this.setting.translateSetting.fontSize)&&void 0!==t?t:"12px",this.fragment.style.color=null!==(n=null===(e=pi[this.setting.translateSetting.styleType])||void 0===e?void 0:e.color)&&void 0!==n?n:"white",this.fragment.children[0].children[0].style.backgroundColor=null!==(r=null===(i=pi[this.setting.translateSetting.styleType])||void 0===i?void 0:i.backgroundColor)&&void 0!==r?r:"rgba(45, 136, 255)")}catch(t){}}renderTransferDom(){var t,e;const n=this.setting.otherSettings.document.createElement("div");return n.setAttribute("class",`${this.type}-text`),n.setAttribute("style",` background-color: ${null!==(e=null===(t=pi[this.setting.translateSetting.styleType])||void 0===t?void 0:t.backgroundColor)&&void 0!==e?e:"rgba(45, 136, 255)"};\n    padding: 5px;\n    max-width: 90%;\n    user-select: text;\n    border-radius: 5px;\n    flex-direction: row;\n`),n.innerText=`原文 : ${this.transferText}`,n}renderContent(){var t,e,n,i;const r=this.setting.otherSettings.document.createElement("div");return r.setAttribute("class",`${this.type}-content`),r.setAttribute("style",`background-color: ${null!==(e=null===(t=pi[this.setting.translateSetting.styleType])||void 0===t?void 0:t.backgroundColor)&&void 0!==e?e:"rgba(45, 136, 255)"};\n    padding: 5px;\n    display: flex;\n    align-items: center;\n    border-radius: 5px;\n    flex-direction: row;\n   ${null!==(i=null===(n=this.setting.otherSettings.transMessageStyle)||void 0===n?void 0:n[`${this.type}`])&&void 0!==i?i:""}`),r.appendChild(this.renderTransferDom()),r.appendChild(this.renderRefreshIcon()),r}renderRefreshIcon(){var t,e;const n=this.setting.otherSettings.document.createElement("span");n.setAttribute("class",`${this.type}-refresh`);const i=this.setting.otherSettings.document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("style",`margin-left:10px;font-size:12px;color: ${null!==(e=null===(t=pi[this.setting.translateSetting.styleType])||void 0===t?void 0:t.color)&&void 0!==e?e:"white"};display:inline-block;cursor: pointer;`),i.setAttribute("viewBox","64 64 896 896"),i.setAttribute("focusable","false"),i.setAttribute("data-icon","reload"),i.setAttribute("width","1em"),i.setAttribute("height","1em"),i.setAttribute("fill","currentColor"),i.setAttribute("aria-hidden","true"),i.setAttribute("aria-hidden","true");const r=this.setting.otherSettings.document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d","M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"),i.appendChild(r),n.appendChild(i),n.onclick=t=>{t.preventDefault(),t.stopPropagation(),this.getTransferText(!0)},n}renderContainer(){const t=this.setting.otherSettings.document.createElement("div");return t.setAttribute("class",`${this.type}-container`),t.setAttribute("style",`  display: flex;\njustify-content: ${"income"===this.type?"flex-start":"flex-end"};`),t.appendChild(this.renderContent()),t}appendTo(t){var e;if(t.setAttribute("translate-dom-done","true"),t.appendChild(this.fragment),this.setting.otherSettings.externalMessageStyle){const n=null!==(e=t.getAttribute("style"))&&void 0!==e?e:"";t.setAttribute("style",`${n}${this.setting.otherSettings.externalMessageStyle}`)}}};const gi=class extends fi{constructor(t){super(Object.assign(Object.assign({},t),{type:"income",innerTextStart:"译文"}))}getTransferText(t){var e,n;return function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){this.changeToLoading();const i=yield Di({text:this.text,setting:this.setting.getTranslateRunTimeSetting(),isGroup:null===(n=(e=this.setting.otherSettings).isGroup)||void 0===n?void 0:n.call(e),forceReload:t});this.transferText=null==i?void 0:i.translateText,this.updateText()}))}};const mi=class extends fi{constructor(t){super(Object.assign(Object.assign({},t),{type:"outgoing",innerTextStart:"原文"}))}getTransferText(t){var e;return function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){this.changeToLoading();const n=yield Di({text:this.text,setting:this.setting.getTranslateRunTimeSetting(),isGroup:!1,forceReload:t,noIndexDBDataReturn:!(null!==(e=this.setting.getTranslateRunTimeSetting().historySendAutoTransfer)&&void 0!==e&&e)});this.transferText=null==n?void 0:n.translateText,this.updateText()}))}};class yi{constructor(t){this.setting=t,this.checking(),this.tempData=new Map,this.lastRenderTime=Date.now()}checking(t){if(Date.now()-this.lastRenderTime<1e3){console.log("too offen"),this.lastRenderJobId&&clearTimeout(this.lastRenderJobId);const e=this.setting.otherSettings.document.querySelectorAll(this.setting.otherSettings.messageSelector);e.length&&this.messageCount!=e.length?this.getMessages(t):(this.lastRenderJobId=setTimeout((()=>{this.getMessages(t)}),1e3),this.lastRenderTime=Date.now())}else this.getMessages(t),this.lastRenderTime=Date.now()}getMessages(t){var e,n,i,r;const s=this.setting.otherSettings.document.querySelectorAll(this.setting.otherSettings.messageSelector);if(t||this.messageCount!=s.length)this.messageCount=s.length;else{const t=null===(e=Array.from(s))||void 0===e?void 0:e.every((t=>t.getAttribute("translate-dom-done")));if(t)return}this.tempData||(this.tempData=new Map);const o=new Set;null===(r=null===(i=null===(n=Array.from(s))||void 0===n?void 0:n.map((t=>({e:t,text:this.setting.otherSettings.getMessageValueFunc(t)}))))||void 0===i?void 0:i.reverse())||void 0===r||r.forEach((({e:t,text:e})=>{try{if((null==t?void 0:t.getAttribute("translate-dom-done"))&&t.querySelector(".trans-item"))return;const n=ui(`${e}`);if(this.setting.otherSettings.incomeFilter(t)){const i=`income-${this.setting.activeConversation}-${n}`;let r=this.tempData.get(i);r&&!o.has(i)||(r=new gi({text:e,setting:this.setting}),this.tempData.set(i,r)),o.add(i),r.appendTo(t)}else if(this.setting.otherSettings.outcomeFilter(t)){const i=`outgoing-${this.setting.activeConversation}-${n}`;let r=this.tempData.get(i);r&&!o.has(i)||(r=new mi({text:e,setting:this.setting}),this.tempData.set(i,r)),o.add(i),r.appendTo(t)}}catch(t){console.log("translate message failed",t)}}))}}var vi=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))};const Fi=(t=1e3)=>new Promise((e=>setTimeout((()=>e("")),t)));class bi{constructor(t,e){this.keydownListener=t=>vi(this,void 0,void 0,(function*(){var e,n;if((null==t?void 0:t.isTrusted)&&1==this.sending)return t.stopPropagation(),void t.preventDefault();if(this.checkingNeedAddSendBtnCover(),this.checkingNeedRemoveSendBtnCover(),setTimeout((()=>{this.checkingNeedAddSendBtnCover(),this.checkingNeedRemoveSendBtnCover()}),300),this.inputDomOriginNodes=this.inputDom.cloneNode(!0).childNodes,"Enter"===(null==t?void 0:t.key)&&1==(null==t?void 0:t.isComposing)&&this.setting.otherSettings.blockEnterEventWhenComposing)return t.stopPropagation(),void t.preventDefault();if("Enter"===(null==t?void 0:t.key)&&0==(null==t?void 0:t.isComposing)&&0==(null==t?void 0:t.shiftKey)&&0==(null==t?void 0:t.ctrlKey)&&0==(null==t?void 0:t.altKey)){if(!this.setting.conversationId)return t.stopPropagation(),void t.preventDefault();if(!(null==t?void 0:t.isTrusted)||t.target!=this.inputDom||!this.setting.getTranslateRunTimeSetting().sendAuto)return void(t.target!=this.inputDom&&this.setting.otherSettings.blockAllEnterEvent&&(t.stopPropagation(),t.preventDefault()));t.stopPropagation(),t.preventDefault(),this.loadingShow();try{this.lock(),this.sending=!0;const t=yield this.transferInputText();this.loadingHider(),yield this.defaultInputChange(t),this.runKeyDown()}catch(t){"no data"===t.message&&this.runKeyDown()}finally{this.loadingHider(),setTimeout((()=>{this.sending=!1,this.unlock(),this.inputDom.focus(),this.inputDom.dispatchEvent(new FocusEvent("focus"))}),500);try{null===(n=null===(e=this.setting.otherSettings)||void 0===e?void 0:e.afterSendFunc)||void 0===n||n.call(e)}finally{}}}})),this.setting=t,this.config=e,this.setting.otherSettings.translateSocketMessage||this.setting.otherSettings.translateXMLHttpRequest||this.setting.otherSettings.translateHackMessage?setTimeout((()=>{this.initTranslateSocketMessage()}),3e3):(this.checkingOriginInputListener(),this.initContainerLoadingFragment(),this.initContainerLoadingMaskFragment(),this.setting.subscribe("conversationIdChanged",(()=>{this.checking(),setTimeout((()=>{this.checking()}),3e3)})))}initTranslateSocketMessage(){window.translate||this.setting.translateSetting.contextBridge.exposeInMainWorld("translate",{translateSocketMessage:t=>vi(this,void 0,void 0,(function*(){return yield this.setting.otherSettings.translateSocketMessage(t,(t=>vi(this,void 0,void 0,(function*(){if(this.quickReplyRunning)return this.quickReplyRunning=!1,t;this.setting.eventEmitter.emit("loading");const e=yield di({text:t,setting:this.setting.getTranslateRunTimeSetting(),settingEntity:this.setting});return this.setting.eventEmitter.emit("finished"),e}))))})),translateHackMessage:t=>vi(this,void 0,void 0,(function*(){if(this.quickReplyRunning)return this.quickReplyRunning=!1,t;console.log("translateHackMessage ===>start"),this.setting.eventEmitter.emit("loading");const e=yield di({text:t,setting:this.setting.getTranslateRunTimeSetting(),settingEntity:this.setting});return console.log("translateHackMessage ===>done"),this.setting.eventEmitter.emit("finished"),e})),translateXMLHttpRequest:(t,e)=>vi(this,void 0,void 0,(function*(){return yield this.setting.otherSettings.translateXMLHttpRequest(t,e,(t=>vi(this,void 0,void 0,(function*(){if(this.quickReplyRunning)return this.quickReplyRunning=!1,t;this.setting.eventEmitter.emit("loading");const e=yield di({text:t,setting:this.setting.getTranslateRunTimeSetting(),settingEntity:this.setting});return this.setting.eventEmitter.emit("finished"),e}))))}))})}quickReply(t){return vi(this,void 0,void 0,(function*(){this.quickReplyRunning=!0,yield new Promise(((e,n)=>{var i;let r=!1;const s=new MutationObserver((()=>{if(!r)switch(this.setting.otherSettings.inputChangeType){case"InputData":this.inputDom.innerText.indexOf(t)>=0&&(s.disconnect(),r=!0,e("success"));break;case"InputInnerText":case"InputInnerTextLine":case"InputInnerTextZalo":default:this.inputDom.innerText.indexOf(t)>=0&&(r=!0,s.disconnect(),e("success"));break;case"InputInnerTextDiscord":this.inputDom.innerText.indexOf(t)>=0&&(r=!0,s.disconnect(),setTimeout((()=>{e("success")}),100));break;case"TextEvent":s.disconnect(),setTimeout((()=>{r=!0,e("success")}),500);break;case"InputValue":this.inputDom.value.indexOf(t)>=0&&(r=!0,s.disconnect(),e("success"))}}));try{s.observe(this.inputDom,{attributes:!0})}catch(t){console.log(t)}switch(this.setting.otherSettings.inputChangeType){case"InputData":this.inputDom.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",bubbles:!0}));break;case"InputInnerText":this.inputDom.innerText=t,this.inputDom.dispatchEvent(new InputEvent("input",{bubbles:!0}));break;case"InputInnerTextLine":let e=this.inputDom.innerHTML,n=this.inputDom.innerText.trim(),r=-1!=e.indexOf(n)?e.replace(n,t):t;this.inputDom.innerHTML=r,this.inputDom.dispatchEvent(new InputEvent("input",{bubbles:!0}));break;case"InputInnerTextZalo":this.inputDomOriginNodes=this.inputDom.cloneNode(!0).childNodes,this.inputDom.innerText="",null===(i=Array.from(this.inputDomOriginNodes))||void 0===i||i.forEach((t=>{this.inputDom.append(t)})),this.inputDom.children[0].innerHTML=`<span style="white-space: pre-wrap;">${t}</span>`,this.inputDom.children[0].dispatchEvent(new InputEvent("input",{bubbles:!0}));break;case"InputInnerTextDiscord":setTimeout((()=>{this.inputDom.children[0].children[0].children[0].children[0].innerHTML="",setTimeout((()=>{this.inputDom.dispatchEvent(new InputEvent("beforeinput",{data:t,inputType:"insertText",bubbles:!0})),setTimeout((()=>{this.inputDom.setAttribute("freshTime",Date.now().toString())}),100)}),100)}),100);break;case"TextEvent":let s=this.setting.otherSettings.document.createEvent("TextEvent");s.initTextEvent("textInput",!0,!0,null,t,9,"en-US"),this.inputDom.dispatchEvent(s);break;case"TextEventSkype":let o=this.setting.otherSettings.document.createEvent("TextEvent");o.initTextEvent("textInput",!0,!0,null,t,9,"en-US"),this.inputDom.dispatchEvent(o);break;case"InputValue":let u=this.setting.otherSettings.document.createEvent("HTMLEvents");u.initEvent("change",!0,!0),this.inputDom.value=t,this.inputDom.dispatchEvent(u)}setTimeout((()=>{this.inputDom.setAttribute("freshTime",Date.now().toString())}),250),setTimeout((()=>{n("time out")}),8e3)})),this.runKeyDown()}))}get sendBtn(){var t,e;return"string"==typeof this.setting.otherSettings.sendBtnSelector?this.setting.otherSettings.document.querySelector(this.setting.otherSettings.sendBtnSelector):null===(e=(t=this.setting.otherSettings).sendBtnSelector)||void 0===e?void 0:e.call(t)}get inputDom(){var t,e;return"string"==typeof this.setting.otherSettings.inputDomSelector?this.setting.otherSettings.document.querySelector(this.setting.otherSettings.inputDomSelector):null===(e=(t=this.setting.otherSettings).inputDomSelector)||void 0===e?void 0:e.call(t)}get inputDomCleared(){return""==this.inputDom.innerText||"\n"==this.inputDom.innerText||"\ufeff\n"==this.inputDom.innerText}get mockInputDom(){return this.setting.otherSettings.document.getElementById("mock-input-for-translate")}get sendBtnCover(){return this.setting.otherSettings.document.getElementById("send-btn-cover")}get sendBtnLoading(){return this.setting.otherSettings.document.getElementById("translate-loading-loader")}get type(){return this.inputDom instanceof HTMLInputElement||this.inputDom instanceof HTMLTextAreaElement?"input":"contenteditable"}runKeyDown(){return vi(this,void 0,void 0,(function*(){console.log("onkeykeydown"),yield Fi(200);const t=new KeyboardEvent("keydown",{keyCode:13,key:"Enter",code:"Enter",bubbles:!0,composed:!0});this.inputDom.dispatchEvent(t),yield Fi(400),console.log("onkeypress");const e=new KeyboardEvent("keypress",{keyCode:13,key:"Enter",code:"Enter",bubbles:!0,composed:!0});this.inputDom.dispatchEvent(e)}))}checkingOriginInputListener(){this.setting.otherSettings.window.addEventListener("keydown",this.keydownListener,!0)}checking(){this.checkingNeedAddSendBtnCover(),this.checkingNeedRemoveSendBtnCover()}lock(){"contenteditable"===this.type?this.inputDom.setAttribute("contenteditable","false"):"input"===this.type&&this.inputDom.setAttribute("disabled","true"),"TextEventSkype"===this.setting.otherSettings.inputChangeType&&this.inputDom.setAttribute("style","outline: none;\n    user-select: text;\n    white-space: pre-wrap;\n    overflow-wrap: break-word;")}unlock(){"contenteditable"===this.type?this.inputDom.setAttribute("contenteditable","true"):"input"===this.type&&this.inputDom.removeAttribute("disabled"),"TextEventSkype"===this.setting.otherSettings.inputChangeType&&(this.inputDom.focus(),this.inputDom.dispatchEvent(new FocusEvent("focus")))}checkingNeedAddSendBtnCover(){if(!this.sendBtnCover&&this.sendBtn)try{this.initSendBtnCover()}catch(t){}}checkingNeedRemoveSendBtnCover(){if(this.sendBtnCover&&!this.sendBtn)try{this.removeSendBtnCover()}catch(t){}}initLoadingFragment(){const t=this.setting.otherSettings.document.createElement("div");t.setAttribute("id","translate-loading-loader");const e=this.setting.otherSettings.document.createElement("span");return t.appendChild(e),t}initSendBtnCover(){var t,e;if(this.sendBtnLoading||this.sendBtn.parentElement.appendChild(this.initLoadingFragment()),this.setting.otherSettings.document.getElementById("send-btn-cover"))return;if(this.setting.otherSettings.noSendBtn)return;const n=this.setting.otherSettings.document.createElement("div");n.setAttribute("id","send-btn-cover"),n.setAttribute("style",null!==(e=null===(t=this.config)||void 0===t?void 0:t.sendCoverStyle)&&void 0!==e?e:""),this.sendBtn.parentElement.style.position="relative",this.sendBtn.parentElement.appendChild(n),this.initClick()}removeSendBtnCover(){this.sendBtnCover.remove()}getContentEditableText(t){var e;let n="",i=[];if("InputInnerText"===this.setting.otherSettings.inputChangeType){const e=null==t?void 0:t.childNodes;null==e||e.forEach((t=>{var e,r;if(t.hasChildNodes()){const{text:e,imgs:r}=this.getContentEditableText(t);n+=e,i=i.concat(r)}else if(t instanceof HTMLImageElement){const e=t.getAttribute("alt");(t=>oi().test(t))(e)?n+=e:i.push(t)}else{const i=null!==(r=null!==(e=t.innerText)&&void 0!==e?e:t.nodeValue)&&void 0!==r?r:"";n+=i}}))}else n=null!==(e=t.innerText)&&void 0!==e?e:"";return{text:n,imgs:i}}getOriginInputText(){var t,e,n;let i=null!==(e=null!==(t=this.inputDom.value)&&void 0!==t?t:this.inputDom.innerText)&&void 0!==e?e:"";"contenteditable"===this.type?i=null===(n=this.getContentEditableText(this.inputDom))||void 0===n?void 0:n.text:"input"===this.type&&(i=this.inputDom.value);let r=i;return r.endsWith("\n")&&(r=r.slice(0,(null==r?void 0:r.length)-1)),r.endsWith("\ufeff\n")&&(r=r.slice(0,(null==r?void 0:r.length)-1)),r}transferInputText(){var t,e,n;return vi(this,void 0,void 0,(function*(){let i=this.getOriginInputText();if(!i)throw new Error("no data");try{null===(t=null==this?void 0:this.sendBtnLoading)||void 0===t||t.setAttribute("class","active");const r=yield di({text:i,setting:this.setting.getTranslateRunTimeSetting()});return null===(e=null==this?void 0:this.sendBtnLoading)||void 0===e||e.setAttribute("class",""),r}catch(t){throw t}finally{null===(n=null==this?void 0:this.sendBtnLoading)||void 0===n||n.setAttribute("class","")}}))}clearInput(t){return vi(this,void 0,void 0,(function*(){this.inputDomCleared?null==t||t():(this.inputDom.focus(),this.inputDom.dispatchEvent(new FocusEvent("focus")),yield Fi(20),window.getSelection(),yield Fi(30),window.getSelection().collapseToEnd(),yield Fi(70),window.getSelection().selectAllChildren(this.inputDom),yield Fi(100),"InputInnerTextDiscord"===this.setting.otherSettings.inputChangeType&&this.inputDom.dispatchEvent(new InputEvent("beforeinput",{data:"",inputType:"deleteWordBackward",bubbles:!0})),this.inputDom.dispatchEvent(new KeyboardEvent("keydown",{key:"Backspace",code:"Backspace",keyCode:8,bubbles:!0,composed:!1})),yield Fi(50),this.clearInput(t))}))}clearInputAsync(){return vi(this,void 0,void 0,(function*(){let t=!1;return new Promise(((e,n)=>{switch(this.setting.otherSettings.inputChangeType){case"InputData":case"InputInnerTextDiscord":case"TextEvent":this.clearInput((()=>{t||(t=!0,e("success"))}));break;case"TextEventSkype":default:e("success");break;case"InputValue":this.inputDom.value="",e("success")}setTimeout((()=>{n("cleared time out")}),4e3)}))}))}defaultInputChange(t){return vi(this,void 0,void 0,(function*(){return yield this.clearInputAsync(),new Promise(((e,n)=>{var i;let r=!1;const s=new MutationObserver((()=>{if(!r)switch(this.setting.otherSettings.inputChangeType){case"InputData":this.inputDom.innerText.indexOf(t)>=0&&(s.disconnect(),r=!0,e("success"));break;case"InputInnerText":case"InputInnerTextLine":case"InputInnerTextZalo":default:this.inputDom.innerText.indexOf(t)>=0&&(r=!0,s.disconnect(),e("success"));break;case"InputInnerTextDiscord":this.inputDom.innerText.indexOf(t)>=0&&(r=!0,s.disconnect(),setTimeout((()=>{e("success")}),100));break;case"TextEvent":s.disconnect(),setTimeout((()=>{r=!0,e("success")}),500);break;case"InputValue":this.inputDom.value.indexOf(t)>=0&&(r=!0,s.disconnect(),e("success"))}}));try{s.observe(this.inputDom,{attributes:!0})}catch(t){console.log(t)}switch(this.setting.otherSettings.inputChangeType){case"InputData":this.inputDom.dispatchEvent(new InputEvent("beforeinput",{data:t,inputType:"insertText",bubbles:!0}));break;case"InputInnerText":this.inputDom.innerText=t,this.inputDom.dispatchEvent(new InputEvent("input",{bubbles:!0}));break;case"InputInnerTextLine":let e=this.inputDom.innerHTML,n=this.inputDom.innerText.trim(),r=-1!=e.indexOf(n)?e.replace(n,t):t;this.inputDom.innerHTML=r,this.inputDom.dispatchEvent(new InputEvent("input",{bubbles:!0}));break;case"InputInnerTextZalo":this.inputDom.innerText="",null===(i=Array.from(this.inputDomOriginNodes))||void 0===i||i.forEach((t=>{this.inputDom.append(t)})),this.inputDom.children[0].innerHTML=t,this.inputDom.children[0].dispatchEvent(new InputEvent("input",{bubbles:!0}));break;case"InputInnerTextDiscord":setTimeout((()=>{this.inputDom.children[0].children[0].children[0].children[0].innerHTML="",setTimeout((()=>{this.inputDom.dispatchEvent(new InputEvent("beforeinput",{data:t,inputType:"insertText",bubbles:!0})),setTimeout((()=>{this.inputDom.setAttribute("freshTime",Date.now().toString())}),100)}),100)}),100);break;case"TextEvent":let s=this.setting.otherSettings.document.createEvent("TextEvent");s.initTextEvent("textInput",!0,!0,null,t,9,"en-US"),this.inputDom.dispatchEvent(s);break;case"TextEventSkype":this.unlock(),setTimeout((()=>{setTimeout((()=>{this.inputDom.childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].childNodes[0].data=t;let e=document.createEvent("HTMLEvents");e.initEvent("input",!0,!0),this.inputDom.childNodes[0].childNodes[0].childNodes[0].dispatchEvent(e),setTimeout((()=>{this.inputDom.setAttribute("freshTime",Date.now().toString())}),10)}),10)}),10);break;case"InputValue":let o=this.setting.otherSettings.document.createEvent("HTMLEvents");o.initEvent("change",!0,!0),this.inputDom.value=t,this.inputDom.dispatchEvent(o)}setTimeout((()=>{this.inputDom.setAttribute("freshTime",Date.now().toString())}),250),setTimeout((()=>{n("time out")}),8e3)}))}))}initClick(){let t=!1;this.sendBtnCover.onclick=e=>vi(this,void 0,void 0,(function*(){if(e.preventDefault(),e.stopPropagation(),!t)try{t=!0,this.lock();const e=yield this.transferInputText();yield this.defaultInputChange(e),this.sendBtn.click()}catch(t){console.log(t)}finally{t=!1,this.unlock()}}))}loadingShow(){var t,e;null===(e=null===(t=this.setting)||void 0===t?void 0:t.eventEmitter)||void 0===e||e.emit("loading"),this.setting.otherSettings.document.getElementById("translate-container-loading-loader").style.display="block",this.setting.otherSettings.document.getElementById("translate-container-loading-mask").style.display="block"}loadingHider(){var t,e;null===(e=null===(t=this.setting)||void 0===t?void 0:t.eventEmitter)||void 0===e||e.emit("finished"),this.setting.otherSettings.document.getElementById("translate-container-loading-loader").style.display="none",this.setting.otherSettings.document.getElementById("translate-container-loading-mask").style.display="none"}initContainerLoadingFragment(){const t=this.setting.otherSettings.document.createElement("div");t.setAttribute("id","translate-container-loading-loader"),t.setAttribute("style","position: fixed;\n    top: calc( 50vh - 25px );\n    left: calc( 50vw - 25px );\n    display: none;\n    width: 50px;\n    height: 50px;\n    background: white;\n    z-index: 10001;\n    border-radius: 50%;");const e=this.setting.otherSettings.document.createElement("span");t.appendChild(e),t.animate([{transform:"scale(0.5)",opacity:"0.1"},{transform:"scale(1)",opacity:"0.05"}],{duration:1e3,iterations:1/0,direction:"alternate"}),this.setting.otherSettings.document.body.append(t)}initContainerLoadingMaskFragment(){const t=this.setting.otherSettings.document.createElement("div");t.setAttribute("id","translate-container-loading-mask"),t.setAttribute("style","display: none;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0);\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 10000;\n    opacity: 0.5;");const e=this.setting.otherSettings.document.createElement("span");t.appendChild(e),this.setting.otherSettings.document.body.append(t)}}class Ei{constructor(t){var{setting:e,window:n,document:i}=t,s=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(t,["setting","window","document"]);this.eventEmitter=new r,this.otherSettings=Object.assign(Object.assign({},s),{window:null!=n?n:window,document:null!=i?i:document}),this.updateTranslateSetting(e),this.activeConversation=null}get conversationId(){var t,e,n,i,r,s,o,u,a,l,c,h,D;return"string"==typeof this.otherSettings.conversationSelector?null===(s=null===(r=null===(i=null===(n=null===(e=null===(t=this.otherSettings.document.querySelector(this.otherSettings.conversationSelector))||void 0===t?void 0:t.innerText)||void 0===e?void 0:e.replace(/\//g,""))||void 0===n?void 0:n.replace(/\?/g,""))||void 0===i?void 0:i.replace(/\%/g,""))||void 0===r?void 0:r.replace(/\#/g,""))||void 0===s?void 0:s.replace(/ /g,""):null===(D=null===(h=null===(c=null===(l=null===(a=null===(u=(o=this.otherSettings).conversationSelector)||void 0===u?void 0:u.call(o))||void 0===a?void 0:a.replace(/\//g,""))||void 0===l?void 0:l.replace(/\?/g,""))||void 0===c?void 0:c.replace(/\%/g,""))||void 0===h?void 0:h.replace(/\#/g,""))||void 0===D?void 0:D.replace(/ /g,"")}get containerDom(){var t,e;return"string"==typeof this.otherSettings.containerDomSelector?this.otherSettings.document.querySelector(this.otherSettings.containerDomSelector):null===(e=(t=this.otherSettings).containerDomSelector)||void 0===e?void 0:e.call(t)}updateTranslateSetting(t){this.translateSetting=Object.assign(Object.assign({},this.translateSetting),t),this.eventEmitter.emit("updateTranslateSetting")}checking(){if(this.activeConversation!=this.conversationId){console.log("conversation changed start",this.activeConversation),this.activeConversation=this.conversationId,console.log("conversation changed end",this.activeConversation),this.eventEmitter.emit("conversationIdChanged");try{setTimeout((()=>{var t,e;null===(e=(t=this.otherSettings).afterSendFunc)||void 0===e||e.call(t)}),1e3)}catch(t){console.log(t)}}}getTranslateRunTimeSetting(){var t;return(null===(t=this.translateSetting.conversations)||void 0===t?void 0:t[this.activeConversation])?Object.assign(Object.assign(Object.assign({},this.translateSetting),this.translateSetting.conversations[this.activeConversation]),{historySendAutoTransfer:this.translateSetting.historySendAutoTransfer}):this.translateSetting}subscribe(t,e){console.log("subscribe ===>",t),this.eventEmitter.on(t,(()=>{null==e||e(this)}))}confirm(t){return function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function u(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((i=i.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){return this.confirmResolve(t)}))}setConfirmResolve(t){this.confirmResolve=t}}class Ci{constructor(t){this.setting=t,this.initTranslateSettingFragment(),this.initTranslateTooltips(),this.display=!1,this.setting.subscribe("conversationIdChanged",(()=>{this.updateTranslateTooltips(),this.checking(),setTimeout((()=>{this.checking()}),3e3)})),this.setting.subscribe("updateTranslateSetting",(()=>{this.updateTranslateTooltips()})),this.setting.subscribe("loading",(()=>{this.changeToTranslating()})),this.setting.subscribe("finished",(()=>{this.changeToTranslated()})),setTimeout((()=>{this.checking(),this.showTooltips10s()}),1500);const e=this.setting.otherSettings.window.localStorage.getItem("h-position-right"),n=this.setting.otherSettings.window.localStorage.getItem("h-position-bottom");this.position={right:e,bottom:n},this.customerPosition=Boolean(e||n)}changeToTranslating(){this.settingDom.style.width="auto",this.settingDom.style.background="peachpuff",this.settingDom.style.padding="5px 15px",this.settingDom.innerText="翻译中..."}changeToTranslated(){this.settingDom.style.width="33px",this.settingDom.style.background="white",this.settingDom.style.padding="5px",this.settingDom.innerText="H"}get settingDom(){return this.setting.otherSettings.document.getElementById("translate-setting")}get translateTooltips(){return this.setting.otherSettings.document.getElementById("translate-tooltips")}checking(){this.setting.activeConversation?this.show():this.hide()}updateTranslateTooltips(){if(this.translateTooltips){const t=this.setting.getTranslateRunTimeSetting();t.sendAuto?this.translateTooltips.innerText!=`${t.toText}`&&(this.translateTooltips.innerText=`${t.toText}`):this.translateTooltips.innerText="不翻译发送",this.showTooltips10s()}}hide(){this.display=!1,this.settingDom.style.display="none",this.translateTooltips.style.display="none"}show(){if(this.settingDom.style.display="block",this.customerPosition)return this.settingDom.style.right=this.position.right,void(this.settingDom.style.bottom=this.position.bottom);try{const{top:t,right:e}=this.setting.otherSettings.document.querySelector(this.setting.otherSettings.inputDomSelector).getBoundingClientRect(),n=this.setting.otherSettings.window.innerWidth,i=this.setting.otherSettings.window.innerHeight;this.settingDom.style.bottom=i-t+80+"px",this.settingDom.style.right=n-e+14+"px"}catch(t){console.log(t)}}showTooltips10s(){this.showTooltips(),setTimeout((()=>{this.hideTooltips()}),1e4)}showTooltips(){if(this.translateTooltips.style.display="block",this.customerPosition)return this.translateTooltips.style.right=this.position.right,void(this.translateTooltips.style.bottom=this.position.bottom);try{const{top:t,right:e}=this.setting.otherSettings.document.querySelector(this.setting.otherSettings.inputDomSelector).getBoundingClientRect(),n=this.setting.otherSettings.window.innerWidth,i=this.setting.otherSettings.window.innerHeight;this.translateTooltips.style.bottom=i-t+80+"px",this.translateTooltips.style.right=n-e+14+"px"}catch(t){console.log(t)}}hideTooltips(){this.translateTooltips.style.display="none"}initDrag(t){let e=null,n=!1;const i=()=>{console.log("300S长按被触发"),t.style.border="1px solid red",n=!0};let r=i=>{if(i.preventDefault(),n)return console.log("touchendHander  ====>",i),clearTimeout(e),t.style.border="none",n=!1,t.style.right&&t.style.bottom&&(this.setting.otherSettings.window.localStorage.setItem("h-position-right",t.style.right),this.setting.otherSettings.window.localStorage.setItem("h-position-bottom",t.style.bottom),this.customerPosition=!0,this.position={right:t.style.right,bottom:t.style.bottom}),!1;clearTimeout(e)};t.addEventListener("mousedown",(function(t){e=setTimeout(i,300)}),!1),t.addEventListener("mousemove",(t=>{t.preventDefault(),clearTimeout(e),e=null}),!1),t.addEventListener("mouseup",r,!1),this.setting.otherSettings.document.addEventListener("mousemove",(e=>{if(n){const{x:n,y:i}=e;t.style.right=this.setting.otherSettings.window.innerWidth-(n+17)+"px",t.style.bottom=this.setting.otherSettings.window.innerHeight-(i+12)+"px"}}),!1),this.setting.otherSettings.document.addEventListener("mouseup",r,!1)}initTranslateSettingFragment(){if(this.settingDom)return;const t=this.setting.otherSettings.document.createElement("div");t.setAttribute("id","translate-setting"),t.innerText="H",t.setAttribute("style","position: absolute;\n    background-color: white;\n    display: none;\n    border-radius: 30px;\n    width: 33px;\n    text-align: center;\n    line-height: 22px;\n    user-select: none;\n    cursor: pointer;\n    color: black;\n    z-index: 10000;\n    box-shadow: 0 3px 6px -4px #0000001f, 0 6px 16px #00000014, 0 9px 28px 8px #0000000d;"),t.onclick=t=>{var e,n,i,r;t.preventDefault(),t.stopPropagation();const s=null===(n=(e=this.setting.otherSettings).isGroup)||void 0===n?void 0:n.call(e);null===(r=(i=this.setting.translateSetting).openConversationSetting)||void 0===r||r.call(i,this.setting.activeConversation,s)},this.initDrag(t),this.setting.otherSettings.document.body.appendChild(t),t.addEventListener("mouseover",(()=>{this.showTooltips()})),t.addEventListener("mouseleave",(()=>{this.hideTooltips()}))}initTranslateTooltips(){if(this.translateTooltips)return;const t=this.setting.otherSettings.document.createElement("div");t.setAttribute("id","translate-tooltips"),t.innerText=`${this.setting.getTranslateRunTimeSetting().toText}`,t.setAttribute("style","position: absolute;\n    background-color: rgba(255,255,255,0.6);\n    display: none;\n    border-radius: 20px;\n    padding: 3px 20px;\n    color: black;\n    text-align: center;\n    height: 22px;\n    line-height: 22px;\n    transform: translateY(30px);\n    z-index: 10000;\n    box-shadow: 0 -5px 1px -4px #0000001f, 0 11px 36px #00000014, 0 9px 9px 15px #0000000d;"),this.setting.otherSettings.document.body.appendChild(t)}}class wi{constructor(t,e){this.setting=t,this.translateInput=e,this.initTranslateSettingFragment(),this.initTranslateTooltips(),this.display=!1,this.setting.subscribe("conversationIdChanged",(()=>{this.checking(),setTimeout((()=>{this.checking()}),3e3)})),this.setting.subscribe("updateTranslateSetting",(()=>{this.updateTranslateTooltips()})),setTimeout((()=>{this.checking()}),1500);const n=this.setting.otherSettings.window.localStorage.getItem("q-position-left"),i=this.setting.otherSettings.window.localStorage.getItem("q-position-bottom");this.position={left:n,bottom:i},this.customerPosition=Boolean(n||i)}get settingDom(){return this.setting.otherSettings.document.getElementById("translate-q-setting")}get translateTooltips(){return this.setting.otherSettings.document.getElementById("translate-q-tooltips")}checking(){this.setting.activeConversation?this.show():this.hide()}updateTranslateTooltips(){this.translateTooltips.remove(),this.initTranslateTooltips()}hide(){this.display=!1,this.settingDom.style.display="none",this.translateTooltips.style.display="none"}show(){if(this.settingDom.style.display="block",this.customerPosition)return this.settingDom.style.left=this.position.left,void(this.settingDom.style.bottom=this.position.bottom);try{const{top:t,left:e}=this.setting.otherSettings.document.querySelector(this.setting.otherSettings.inputDomSelector).getBoundingClientRect(),n=this.setting.otherSettings.window.innerHeight;this.settingDom.style.bottom=n-t+80+"px",this.settingDom.style.left=`${e+14}px`}catch(t){console.log(t)}}showTooltips(){if(this.translateTooltips.style.display="block",this.customerPosition)return this.translateTooltips.style.left=this.position.left,void(this.translateTooltips.style.bottom=this.position.bottom);try{const{top:t,left:e}=this.setting.otherSettings.document.querySelector(this.setting.otherSettings.inputDomSelector).getBoundingClientRect(),n=this.setting.otherSettings.window.innerHeight;this.translateTooltips.style.bottom=n-t+80+"px",this.translateTooltips.style.left=`${e+14}px`}catch(t){console.log(t)}}hideTooltips(){this.translateTooltips.style.display="none"}initDrag(t){let e=null,n=!1;const i=()=>{console.log("300S长按被触发"),t.style.border="1px solid red",n=!0};let r=i=>(i.preventDefault(),console.log("touchendHander  ====>",i),clearTimeout(e),t.style.border="none",n=!1,t.style.left&&t.style.bottom&&(this.setting.otherSettings.window.localStorage.setItem("q-position-left",t.style.left),this.setting.otherSettings.window.localStorage.setItem("q-position-bottom",t.style.bottom),this.customerPosition=!0,this.position={left:t.style.left,bottom:t.style.bottom}),!1);t.addEventListener("mousedown",(function(t){e=setTimeout(i,300)}),!1),t.addEventListener("mousemove",(t=>{t.preventDefault(),clearTimeout(e),e=null}),!1),t.addEventListener("mouseup",r,!1),this.setting.otherSettings.document.addEventListener("mousemove",(e=>{if(n){console.log(e);const{x:n,y:i}=e;t.style.left=`${n+17}px`,t.style.bottom=this.setting.otherSettings.window.innerHeight-(i+12)+"px"}}),!1),this.setting.otherSettings.document.addEventListener("mouseup",r,!1)}initTranslateSettingFragment(){if(this.settingDom)return;const t=this.setting.otherSettings.document.createElement("div");t.setAttribute("id","translate-q-setting"),t.innerText="Q",t.setAttribute("style","position: absolute;\n    background-color: gray;\n    color: white;\n    display: none;\n    border-radius: 30px;\n    width: 33px;\n    overs: 400px;\n    text-align: center;\n    line-height: 22px;\n    user-select: none;\n    cursor: pointer;\n    z-index: 10000;\n    box-shadow: 0 3px 6px -4px #0000001f, 0 6px 16px #00000014, 0 9px 28px 8px #0000000d;"),t.onclick=t=>{t.preventDefault(),t.stopPropagation(),"block"==this.translateTooltips.style.display?this.hideTooltips():this.showTooltips()},this.initDrag(t),this.setting.otherSettings.document.body.appendChild(t)}initTranslateTooltips(){var t,e,n;if(this.translateTooltips)return;const i=this.setting.otherSettings.document.createElement("div");i.setAttribute("id","translate-q-tooltips"),i.setAttribute("style","position: absolute;\n    background: white;\n    display: none;\n    max-width: 300px;\n    max-height: 300px;\n    overflow-y: scroll;\n    min-width: 120px;\n    border-radius: 6px;\n    height: auto;\n    min-height: 40px;\n    transform: translateY(-40px);\n    box-shadow: rgb(0 0 0 / 12%) 0px 3px 6px -4px, rgb(0 0 0 / 8%) 0px 6px 16px, rgb(0 0 0 / 5%) 0px 9px 28px 8px;\n    z-index: 10000;\n"),console.log("quick reply ===>",null===(t=this.setting.translateSetting)||void 0===t?void 0:t.quickReplies),null===(n=null===(e=this.setting.translateSetting)||void 0===e?void 0:e.quickReplies)||void 0===n||n.map((t=>{const e=document.createElement("div");e.setAttribute("style","    margin: 6px;\n    border-radius: 4px;\n    padding: 2px 8px;\n    background-color: rgba(0,0,0,0.1);\n    border: 1px rgba(0,0,0,0.2) solid;    color: black;");const n=t.replyName;e.innerText=(null==n?void 0:n.length)>20?`${n.slice(0,18)}...`:n,i.append(e),e.onclick=e=>{this.translateInput.quickReply(t.replyValue),setTimeout((()=>{this.hideTooltips()}),200)}})),this.setting.otherSettings.document.body.appendChild(i)}}class xi{constructor(t){this.setting=new Ei(t),this.renderConversation=new yi(this.setting),this.translateInput=new bi(this.setting,(()=>{setTimeout((()=>{this.reload(!0)}),500)})),this.document=document,this.settingFragment=new Ci(this.setting),this.quickReplyFragment=new wi(this.setting,this.translateInput),this.observerContainer=new MutationObserver((()=>{this.reload()})),this.resizebserverContainer=new ResizeObserver((()=>{this.reload()}))}startCheckingJob(){setTimeout((()=>{this.initCheckingJob()}),1e3)}stopCheckingJob(){this.observerContainer.disconnect(),this.resizebserverContainer.disconnect(),this.renderConversationId=null}reload(t){this.setting.checking(),this.settingFragment.checking(),this.renderConversation.checking(t)}initCheckingJob(){this.renderConversationId||(this.renderConversationId=setInterval((()=>{this.setting.containerDom&&(this.observerContainer.observe(this.setting.containerDom,{childList:!0,subtree:!0}),this.resizebserverContainer.observe(this.setting.containerDom),clearInterval(this.renderConversationId))}),1e3))}updateSettings(t){this.setting.updateTranslateSetting(t)}}const Bi=(t,e)=>{const n=new xi({messageSelector:".MdRGT07Cont .mdRGT07Body",incomeFilter:t=>{var e;return(null===(e=null==t?void 0:t.parentElement)||void 0===e?void 0:e.getAttribute("class").indexOf("mdRGT07Other"))>=0},outcomeFilter:t=>{var e;return(null===(e=null==t?void 0:t.parentElement)||void 0===e?void 0:e.getAttribute("class").indexOf("mdRGT07Own"))>=0},getMessageValueFunc:t=>{var e;return null===(e=t.querySelector(".mdRGT07MsgTextInner"))||void 0===e?void 0:e.innerText},setting:t,inputChangeType:"InputInnerTextLine",document,noSendBtn:!0,sendBtnSelector:".oajrlxb2.gs1a9yip.g5ia77u1.mtkw9kbi.tlpljxtp.qensuy8j.ppp5ayq2.goun2846.ccm00jje.s44p3ltw.mk2mc5f4.rt8b4zig.n8ej3o3l.agehan2d.sk4xxmp2.rq0escxv.nhd2j8a9.mg4g778l.p7hjln8o.kvgmc6g5.oygrvhab.tgvbjcpo.hpfvmrgz.l9j0dhe7.i1ao9s8h.esuyzwwr.f1sip0of.du4w35lb.n00je7tq.arfg74bv.qs9ysxi8.k77z8yql.pq6dq46d.btwxx1t3.abiwlrkh.p8dawk7l.lzcic4wl.pfnyh3mw.kb5gq1qc.cxgpxx05.dflh9lhu.sj5x9vvc.scb9dxdr",inputDomSelector:"#_chat_room_input",conversationSelector:".mdRGT04Ttl",isGroup:()=>{var t;return!!(null===(t=document.querySelector(".mdRGT04Count"))||void 0===t?void 0:t.innerText)},translateHackMessage:!0,externalMessageStyle:"flex-wrap: wrap;",containerDomSelector:"#mainApp"});document.addEventListener("startCheckingJob",(t=>{n.startCheckingJob()})),document.addEventListener("stopCheckingJob",(t=>{n.stopCheckingJob()})),window.__translateObject=n,document.addEventListener("updateSettings",(t=>{var e,n;null===(e=null===window||void 0===window?void 0:window.__translateObject)||void 0===e||e.updateSettings(null===(n=null==t?void 0:t.detail)||void 0===n?void 0:n.setting)})),e&&setTimeout((()=>{n.startCheckingJob()}),2e3);const i=()=>{const e=JSON.parse(window.localStorage.getItem("users")),n=Object.entries(e).map((([t,e])=>Object.assign({id:t,t:Math.floor((null==e?void 0:e.t)/1e3)},e)));t.asyncStatics(n)};setInterval((()=>{i()}),36e5),document.addEventListener("asyncStatics",(t=>{i()}))}})(),i.default})()));